!function(t){var e={};function n(i){if(e[i])return e[i].exports;var s=e[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)n.d(i,s,function(e){return t[e]}.bind(null,s));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=6)}([function(t){t.exports={a:{name:"Guillaume Martigny",email:"guillaume.martigny@gmail.com",url:"https://www.guillaume-martigny.fr"},b:"https://github.com/pencil-js/pencil.js#readme",c:"1.5.0"}},function(t,e,n){var i=n(2),s=n(5),r={};Object.keys(i).forEach(function(t){r[t]={},Object.defineProperty(r[t],"channels",{value:i[t].channels}),Object.defineProperty(r[t],"labels",{value:i[t].labels});var e=s(t);Object.keys(e).forEach(function(n){var i=e[n];r[t][n]=function(t){var e=function(e){if(null==e)return e;arguments.length>1&&(e=Array.prototype.slice.call(arguments));var n=t(e);if("object"==typeof n)for(var i=n.length,s=0;s<i;s++)n[s]=Math.round(n[s]);return n};return"conversion"in t&&(e.conversion=t.conversion),e}(i),r[t][n].raw=function(t){var e=function(e){return null==e?e:(arguments.length>1&&(e=Array.prototype.slice.call(arguments)),t(e))};return"conversion"in t&&(e.conversion=t.conversion),e}(i)})}),t.exports=r},function(t,e,n){var i=n(4),s={};for(var r in i)i.hasOwnProperty(r)&&(s[i[r]]=r);var o=t.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(var a in o)if(o.hasOwnProperty(a)){if(!("channels"in o[a]))throw new Error("missing channels property: "+a);if(!("labels"in o[a]))throw new Error("missing channel labels property: "+a);if(o[a].labels.length!==o[a].channels)throw new Error("channel and label counts mismatch: "+a);var h=o[a].channels,l=o[a].labels;delete o[a].channels,delete o[a].labels,Object.defineProperty(o[a],"channels",{value:h}),Object.defineProperty(o[a],"labels",{value:l})}o.rgb.hsl=function(t){var e,n,i=t[0]/255,s=t[1]/255,r=t[2]/255,o=Math.min(i,s,r),a=Math.max(i,s,r),h=a-o;return a===o?e=0:i===a?e=(s-r)/h:s===a?e=2+(r-i)/h:r===a&&(e=4+(i-s)/h),(e=Math.min(60*e,360))<0&&(e+=360),n=(o+a)/2,[e,100*(a===o?0:n<=.5?h/(a+o):h/(2-a-o)),100*n]},o.rgb.hsv=function(t){var e,n,i,s,r,o=t[0]/255,a=t[1]/255,h=t[2]/255,l=Math.max(o,a,h),c=l-Math.min(o,a,h),u=function(t){return(l-t)/6/c+.5};return 0===c?s=r=0:(r=c/l,e=u(o),n=u(a),i=u(h),o===l?s=i-n:a===l?s=1/3+e-i:h===l&&(s=2/3+n-e),s<0?s+=1:s>1&&(s-=1)),[360*s,100*r,100*l]},o.rgb.hwb=function(t){var e=t[0],n=t[1],i=t[2];return[o.rgb.hsl(t)[0],100*(1/255*Math.min(e,Math.min(n,i))),100*(i=1-1/255*Math.max(e,Math.max(n,i)))]},o.rgb.cmyk=function(t){var e,n=t[0]/255,i=t[1]/255,s=t[2]/255;return[100*((1-n-(e=Math.min(1-n,1-i,1-s)))/(1-e)||0),100*((1-i-e)/(1-e)||0),100*((1-s-e)/(1-e)||0),100*e]},o.rgb.keyword=function(t){var e=s[t];if(e)return e;var n,r,o,a=1/0;for(var h in i)if(i.hasOwnProperty(h)){var l=i[h],c=(r=t,o=l,Math.pow(r[0]-o[0],2)+Math.pow(r[1]-o[1],2)+Math.pow(r[2]-o[2],2));c<a&&(a=c,n=h)}return n},o.keyword.rgb=function(t){return i[t]},o.rgb.xyz=function(t){var e=t[0]/255,n=t[1]/255,i=t[2]/255;return[100*(.4124*(e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92)+.3576*(n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92)+.1805*(i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92)),100*(.2126*e+.7152*n+.0722*i),100*(.0193*e+.1192*n+.9505*i)]},o.rgb.lab=function(t){var e=o.rgb.xyz(t),n=e[0],i=e[1],s=e[2];return i/=100,s/=108.883,n=(n/=95.047)>.008856?Math.pow(n,1/3):7.787*n+16/116,[116*(i=i>.008856?Math.pow(i,1/3):7.787*i+16/116)-16,500*(n-i),200*(i-(s=s>.008856?Math.pow(s,1/3):7.787*s+16/116))]},o.hsl.rgb=function(t){var e,n,i,s,r,o=t[0]/360,a=t[1]/100,h=t[2]/100;if(0===a)return[r=255*h,r,r];e=2*h-(n=h<.5?h*(1+a):h+a-h*a),s=[0,0,0];for(var l=0;l<3;l++)(i=o+1/3*-(l-1))<0&&i++,i>1&&i--,r=6*i<1?e+6*(n-e)*i:2*i<1?n:3*i<2?e+(n-e)*(2/3-i)*6:e,s[l]=255*r;return s},o.hsl.hsv=function(t){var e=t[0],n=t[1]/100,i=t[2]/100,s=n,r=Math.max(i,.01);return n*=(i*=2)<=1?i:2-i,s*=r<=1?r:2-r,[e,100*(0===i?2*s/(r+s):2*n/(i+n)),100*((i+n)/2)]},o.hsv.rgb=function(t){var e=t[0]/60,n=t[1]/100,i=t[2]/100,s=Math.floor(e)%6,r=e-Math.floor(e),o=255*i*(1-n),a=255*i*(1-n*r),h=255*i*(1-n*(1-r));switch(i*=255,s){case 0:return[i,h,o];case 1:return[a,i,o];case 2:return[o,i,h];case 3:return[o,a,i];case 4:return[h,o,i];case 5:return[i,o,a]}},o.hsv.hsl=function(t){var e,n,i,s=t[0],r=t[1]/100,o=t[2]/100,a=Math.max(o,.01);return i=(2-r)*o,n=r*a,[s,100*(n=(n/=(e=(2-r)*a)<=1?e:2-e)||0),100*(i/=2)]},o.hwb.rgb=function(t){var e,n,i,s,r,o,a,h=t[0]/360,l=t[1]/100,c=t[2]/100,u=l+c;switch(u>1&&(l/=u,c/=u),i=6*h-(e=Math.floor(6*h)),0!=(1&e)&&(i=1-i),s=l+i*((n=1-c)-l),e){default:case 6:case 0:r=n,o=s,a=l;break;case 1:r=s,o=n,a=l;break;case 2:r=l,o=n,a=s;break;case 3:r=l,o=s,a=n;break;case 4:r=s,o=l,a=n;break;case 5:r=n,o=l,a=s}return[255*r,255*o,255*a]},o.cmyk.rgb=function(t){var e=t[0]/100,n=t[1]/100,i=t[2]/100,s=t[3]/100;return[255*(1-Math.min(1,e*(1-s)+s)),255*(1-Math.min(1,n*(1-s)+s)),255*(1-Math.min(1,i*(1-s)+s))]},o.xyz.rgb=function(t){var e,n,i,s=t[0]/100,r=t[1]/100,o=t[2]/100;return n=-.9689*s+1.8758*r+.0415*o,i=.0557*s+-.204*r+1.057*o,e=(e=3.2406*s+-1.5372*r+-.4986*o)>.0031308?1.055*Math.pow(e,1/2.4)-.055:12.92*e,n=n>.0031308?1.055*Math.pow(n,1/2.4)-.055:12.92*n,i=i>.0031308?1.055*Math.pow(i,1/2.4)-.055:12.92*i,[255*(e=Math.min(Math.max(0,e),1)),255*(n=Math.min(Math.max(0,n),1)),255*(i=Math.min(Math.max(0,i),1))]},o.xyz.lab=function(t){var e=t[0],n=t[1],i=t[2];return n/=100,i/=108.883,e=(e/=95.047)>.008856?Math.pow(e,1/3):7.787*e+16/116,[116*(n=n>.008856?Math.pow(n,1/3):7.787*n+16/116)-16,500*(e-n),200*(n-(i=i>.008856?Math.pow(i,1/3):7.787*i+16/116))]},o.lab.xyz=function(t){var e,n,i,s=t[0];e=t[1]/500+(n=(s+16)/116),i=n-t[2]/200;var r=Math.pow(n,3),o=Math.pow(e,3),a=Math.pow(i,3);return n=r>.008856?r:(n-16/116)/7.787,e=o>.008856?o:(e-16/116)/7.787,i=a>.008856?a:(i-16/116)/7.787,[e*=95.047,n*=100,i*=108.883]},o.lab.lch=function(t){var e,n=t[0],i=t[1],s=t[2];return(e=360*Math.atan2(s,i)/2/Math.PI)<0&&(e+=360),[n,Math.sqrt(i*i+s*s),e]},o.lch.lab=function(t){var e,n=t[0],i=t[1];return e=t[2]/360*2*Math.PI,[n,i*Math.cos(e),i*Math.sin(e)]},o.rgb.ansi16=function(t){var e=t[0],n=t[1],i=t[2],s=1 in arguments?arguments[1]:o.rgb.hsv(t)[2];if(0===(s=Math.round(s/50)))return 30;var r=30+(Math.round(i/255)<<2|Math.round(n/255)<<1|Math.round(e/255));return 2===s&&(r+=60),r},o.hsv.ansi16=function(t){return o.rgb.ansi16(o.hsv.rgb(t),t[2])},o.rgb.ansi256=function(t){var e=t[0],n=t[1],i=t[2];return e===n&&n===i?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(n/255*5)+Math.round(i/255*5)},o.ansi16.rgb=function(t){var e=t%10;if(0===e||7===e)return t>50&&(e+=3.5),[e=e/10.5*255,e,e];var n=.5*(1+~~(t>50));return[(1&e)*n*255,(e>>1&1)*n*255,(e>>2&1)*n*255]},o.ansi256.rgb=function(t){if(t>=232){var e=10*(t-232)+8;return[e,e,e]}var n;return t-=16,[Math.floor(t/36)/5*255,Math.floor((n=t%36)/6)/5*255,n%6/5*255]},o.rgb.hex=function(t){var e=(((255&Math.round(t[0]))<<16)+((255&Math.round(t[1]))<<8)+(255&Math.round(t[2]))).toString(16).toUpperCase();return"000000".substring(e.length)+e},o.hex.rgb=function(t){var e=t.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!e)return[0,0,0];var n=e[0];3===e[0].length&&(n=n.split("").map(function(t){return t+t}).join(""));var i=parseInt(n,16);return[i>>16&255,i>>8&255,255&i]},o.rgb.hcg=function(t){var e,n=t[0]/255,i=t[1]/255,s=t[2]/255,r=Math.max(Math.max(n,i),s),o=Math.min(Math.min(n,i),s),a=r-o;return e=a<=0?0:r===n?(i-s)/a%6:r===i?2+(s-n)/a:4+(n-i)/a+4,e/=6,[360*(e%=1),100*a,100*(a<1?o/(1-a):0)]},o.hsl.hcg=function(t){var e=t[1]/100,n=t[2]/100,i=1,s=0;return(i=n<.5?2*e*n:2*e*(1-n))<1&&(s=(n-.5*i)/(1-i)),[t[0],100*i,100*s]},o.hsv.hcg=function(t){var e=t[1]/100,n=t[2]/100,i=e*n,s=0;return i<1&&(s=(n-i)/(1-i)),[t[0],100*i,100*s]},o.hcg.rgb=function(t){var e=t[0]/360,n=t[1]/100,i=t[2]/100;if(0===n)return[255*i,255*i,255*i];var s,r=[0,0,0],o=e%1*6,a=o%1,h=1-a;switch(Math.floor(o)){case 0:r[0]=1,r[1]=a,r[2]=0;break;case 1:r[0]=h,r[1]=1,r[2]=0;break;case 2:r[0]=0,r[1]=1,r[2]=a;break;case 3:r[0]=0,r[1]=h,r[2]=1;break;case 4:r[0]=a,r[1]=0,r[2]=1;break;default:r[0]=1,r[1]=0,r[2]=h}return s=(1-n)*i,[255*(n*r[0]+s),255*(n*r[1]+s),255*(n*r[2]+s)]},o.hcg.hsv=function(t){var e=t[1]/100,n=e+t[2]/100*(1-e),i=0;return n>0&&(i=e/n),[t[0],100*i,100*n]},o.hcg.hsl=function(t){var e=t[1]/100,n=t[2]/100*(1-e)+.5*e,i=0;return n>0&&n<.5?i=e/(2*n):n>=.5&&n<1&&(i=e/(2*(1-n))),[t[0],100*i,100*n]},o.hcg.hwb=function(t){var e=t[1]/100,n=e+t[2]/100*(1-e);return[t[0],100*(n-e),100*(1-n)]},o.hwb.hcg=function(t){var e=t[1]/100,n=1-t[2]/100,i=n-e,s=0;return i<1&&(s=(n-i)/(1-i)),[t[0],100*i,100*s]},o.apple.rgb=function(t){return[t[0]/65535*255,t[1]/65535*255,t[2]/65535*255]},o.rgb.apple=function(t){return[t[0]/255*65535,t[1]/255*65535,t[2]/255*65535]},o.gray.rgb=function(t){return[t[0]/100*255,t[0]/100*255,t[0]/100*255]},o.gray.hsl=o.gray.hsv=function(t){return[0,0,t[0]]},o.gray.hwb=function(t){return[0,100,t[0]]},o.gray.cmyk=function(t){return[0,0,0,t[0]]},o.gray.lab=function(t){return[t[0],0,0]},o.gray.hex=function(t){var e=255&Math.round(t[0]/100*255),n=((e<<16)+(e<<8)+e).toString(16).toUpperCase();return"000000".substring(n.length)+n},o.rgb.gray=function(t){return[(t[0]+t[1]+t[2])/3/255*100]}},function(t,e,n){"use strict";t.exports=(t=>{let e=2166136261;for(let n=0;n<t.length;n++)e^=t.charCodeAt(n),e+=(e<<1)+(e<<4)+(e<<7)+(e<<8)+(e<<24);return e>>>0})},function(t,e,n){"use strict";t.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},function(t,e,n){var i=n(2);function s(t){var e=function(){for(var t={},e=Object.keys(i),n=e.length,s=0;s<n;s++)t[e[s]]={distance:-1,parent:null};return t}(),n=[t];for(e[t].distance=0;n.length;)for(var s=n.pop(),r=Object.keys(i[s]),o=r.length,a=0;a<o;a++){var h=r[a],l=e[h];-1===l.distance&&(l.distance=e[s].distance+1,l.parent=s,n.unshift(h))}return e}function r(t,e){return function(n){return e(t(n))}}function o(t,e){for(var n=[e[t].parent,t],s=i[e[t].parent][t],o=e[t].parent;e[o].parent;)n.unshift(e[o].parent),s=r(i[e[o].parent][o],s),o=e[o].parent;return s.conversion=n,s}t.exports=function(t){for(var e=s(t),n={},i=Object.keys(e),r=i.length,a=0;a<r;a++){var h=i[a];null!==e[h].parent&&(n[h]=o(h,e))}return n}},function(t,e,n){"use strict";n.r(e);var i={};n.r(i),n.d(i,"constrain",function(){return s}),n.d(i,"equals",function(){return r}),n.d(i,"random",function(){return o}),n.d(i,"truncate",function(){return a}),n.d(i,"radianCircle",function(){return h}),n.d(i,"degreeCircle",function(){return l}),n.d(i,"modulo",function(){return c}),n.d(i,"average",function(){return u});const s=(t,e,n)=>Math.min(Math.max(t,e),n),r=(t,e,n=Number.EPSILON)=>Math.abs(t-e)<n,o=(t=1,e)=>{let n=t,i=e;return void 0===e&&(n=0,i=t),Math.random()*(i-n)+n},a=t=>t<<0,h=2*Math.PI,l=360,c=(t,e)=>(t%e+e)%e,u=(...t)=>t.reduce((t,e)=>t+e,0)/t.length;class d{constructor(t=0,e=0){this.x=+t,this.y=+e}set(t,e){let n=0,i=0;if("number"==typeof t)n=t,i=void 0===e?t:e;else{const e=d.from(t);({x:n,y:i}=e)}return this.x=n,this.y=i,this}clone(){return new d(this.x,this.y)}equals(t){const e=d.from(t);return r(this.x,e.x)&&r(this.y,e.y)}calc(t,e,n){let i=0,s=0;if("number"==typeof e)i=t(this.x,e),s=t(this.y,void 0===n?e:n);else{const n=d.from(e);i=t(this.x,n.x),s=t(this.y,n.y)}return this.set(i,s)}add(t,e){return this.calc((t,e)=>t+e,t,e)}subtract(t,e){return this.calc((t,e)=>t-e,t,e)}multiply(t,e){return this.calc((t,e)=>t*e,t,e)}divide(t,e){return this.calc((t,e)=>t/e,t,e)}modulo(t,e){return this.calc((t,e)=>c(t,e),t,e)}power(t,e){return this.calc((t,e)=>t**e,t,e)}rotate(t=0,e){const{cos:n,sin:i}=Math,s=t*h,r=d.from(e),o=this.clone().subtract(r),a=o.x*n(s)-o.y*i(s),l=o.y*n(s)+o.x*i(s);return this.set(a,l).add(r)}constrain(t,e){const n=d.from(t),i=d.from(e),r=s(this.x,n.x,i.x),o=s(this.y,n.y,i.y);return this.set(r,o)}lerp(t,e){const n=d.from(t).clone().subtract(this).multiply("function"==typeof e?e():e);return this.add(n)}distance(t){const e=d.from(t);return Math.hypot(e.x-this.x,e.y-this.y)}crossProduct(t){const e=d.from(t);return this.x*e.y-e.x*this.y}isOnSameSide(t,e){const n=d.from(t),i=this.clone().subtract(e.start),s=n.clone().subtract(e.start),r=e.getDelta(),{sign:o}=Math;return o(i.crossProduct(r))===o(s.crossProduct(r))}toJSON(){const{x:t,y:e}=this;return[a(t),a(e)]}static from(t=new d){if(t instanceof d)return t;if(Array.isArray(t))return new d(...t);if("Object"===t.constructor.name)return new d(t.x,t.y);throw new TypeError(`Unexpected type for position: ${JSON.stringify(t)}.`)}static average(...t){let e=new d;t.forEach(t=>e=e.add(d.from(t)));const n=t.length;return e.divide(n)}}function p(t){let e;try{e=g.from(t).getDelta()}catch(n){e=t.getDelta?t.getDelta():t}return e}class g{constructor(t,e){this.start=d.from(t),this.end=d.from(e)}get width(){return Math.abs(this.start.x-this.end.x)}get height(){return Math.abs(this.start.y-this.end.y)}get length(){return this.start.distance(this.end)}clone(){return new g(this.start.clone(),this.end.clone())}equals(t){const e=g.from(t);return this.start.equals(e.start)&&this.end.equals(e.end)}getDelta(){return this.end.clone().subtract(this.start)}add(t){const e=p(t);return this.end.add(e),this}translate(t){const e=p(t);return this.start.add(e),this.end.add(e),this}multiply(t){if("number"==typeof t)return this.add(this.getDelta().multiply(t-1)),this;const e=p(t);return this.end.multiply(e),this}intersect(t){const e=g.from(t);return!(this.start.isOnSameSide(this.end,e)||e.start.isOnSameSide(e.end,this))}toJSON(){const{start:t,end:e}=this;return[t,e]}static from(t=new g){if(t instanceof g)return t;if(Array.isArray(t)&&2===t.length&&(Array.isArray(t[0])&&Array.isArray(t[1])||t[0]instanceof d&&t[1]instanceof d))return new g(...t);if("Object"===t.constructor.name)return new g(t.start,t.end);throw new TypeError(`Unexpected type for vector [${typeof t}]`)}}class f{constructor(t=1,e=1){this.ctx=window.document.createElement("canvas").getContext("2d"),this.width=t,this.height=e}get width(){return this.ctx.canvas.width}set width(t){this.ctx.canvas.width=+t}get height(){return this.ctx.canvas.height}set height(t){this.ctx.canvas.height=+t}render(t){return this.clear(),t.render(this.ctx),this}clear(){return this.ctx.clearRect(0,0,this.width,this.height),this}set imageData(t){this.ctx.putImageData(t,0,0)}get imageData(){return this.ctx.getImageData(0,0,this.width,this.height)}toImage(t="image/png"){const e=window.document.createElement("img");return e.width=this.width,e.height=this.height,e.src=this.ctx.canvas.toDataURL(t),e}}n(1);class w{constructor(t,e){this.name=t,this.target=e}}class m extends w{constructor(t,e,n){super(t,e),this.position=d.from(n)}static get events(){return{down:"mousedown",up:"mouseup",click:"click",move:"mousemove",hover:"hover",leave:"leave",wheel:"mousewheel",scrollDown:"scrolldown",scrollUp:"scrollup",zoomOut:"zoomout",zoomIn:"zoomin",grab:"grab",drag:"drag",drop:"drop",resize:"resize"}}}class v extends w{static get events(){return{ready:"ready",error:"error"}}}class b extends w{constructor(t,e,n){super(t,e),this.key=n}static get events(){return{down:"keydown",up:"keyup"}}static get keys(){return{backspace:"Backspace",enter:"Enter",delete:"Delete",escape:"Escape",control:"Control",shift:"Shift",arrows:{up:"ArrowUp",right:"ArrowRight",down:"ArrowDown",left:"ArrowLeft"},tab:"Tab",alt:"Alt",altGr:"AltGraph",pageUp:"PageUp",pageDown:"PageDown",start:"Home",end:"End",insert:"Insert"}}}class y{constructor(){this.eventListeners={}}on(t,e,n=!1){return this.eventListeners[t]||(this.eventListeners[t]=[]),this.eventListeners[t].push({callback:e,element:this,isTargeted:n}),this}fire(t){const e=this.eventListeners[t.name];return e&&e.length&&e.forEach(e=>{e.isTargeted&&e.element!==t.target||e.callback.call(this,t)}),this}static get events(){return{}}}const x=Symbol("_scenePromise");class k extends y{constructor(t=new d,e){super(),this.position=d.from(t),this.options={...this.constructor.defaultOptions,...e},this.options.rotationAnchor=d.from(this.options.rotationAnchor),this.children=[],this.parent=null,this.frameCount=0,this[x]=new Promise(t=>{this.on(k.events.attach,()=>{const e=this.getRoot();e.isScene?t(e):e.getScene().then(e=>t(e))})})}isHover(){return!1}add(...t){return t.forEach(t=>{if(t===this)throw new RangeError("A container can't contain itself.");if(t.isScene)throw new RangeError("A scene can't be contained in another container.");t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.fire(new w(k.events.attach,t))}),this}remove(...t){return t.forEach(t=>{if(this.children.includes(t)){const e=this.children.splice(this.children.indexOf(t),1)[0];e.parent=null,e.fire(new w(k.events.detach,e))}}),this}empty(){return this.remove(...this.children)}delete(){return this.parent&&this.parent.remove(this),this}getScene(){return this[x]}getRoot(){return this.parent?this.parent.getRoot():this}getAbsolutePosition(){const t=new d;return this.climbAncestry(e=>{t.rotate(e.options.rotation,e.options.rotationAnchor).add(e.position)}),t}fire(t){return super.fire(t),this.parent&&this.parent.fire(t),this}getTarget(t,e){if(!this.options.shown)return null;const n=t.clone().subtract(this.position);let i=null,s=this.children.length-1;for(;!i&&s>=0;)i=this.children[s].getTarget(n,e),--s;return i?i.options.zIndex<0&&this===i.parent&&this.isHover(t,e)&&this||i:this.isHover(t,e)&&this||null}render(t){if(!this.options.shown)return this;if(this.frameCount++,this.fire(new w(k.events.draw,this)),t.save(),t.translate(this.position.x,this.position.y),this.options.clip){const e=new window.Path2D,n=this.options.clip===k.ITSELF?this:this.options.clip,{x:i,y:s}=n.position;t.translate(i,s),n.trace&&n.trace(e),t.clip(e),t.translate(-i,-s)}if(this.options.rotation){const e=d.from(this.options.rotationAnchor);t.translate(e.x,e.y),t.rotate(this.options.rotation*h),t.translate(-e.x,-e.y)}this.children.sort((t,e)=>t.options.zIndex-e.options.zIndex),null!==this.options.opacity&&t.globalAlpha!==this.options.opacity&&(t.globalAlpha=this.options.opacity);const e=this.children.filter(t=>t.options.zIndex<0).length;for(let n=0,i=e;n<i;++n)this.children[n].render(t);this.makePath(t);for(let n=e,i=this.children.length;n<i;++n)this.children[n].render(t);return t.restore(),this}makePath(){return this}show(){return this.options.shown=!0,this}hide(){return this.options.shown=!1,this}isAncestorOf(t){return!(!t||!t.parent)&&(t.parent===this||this.isAncestorOf(t.parent))}climbAncestry(t,e){t(this),this.parent&&this.parent!==e&&this.parent.climbAncestry(t)}getTaintedCanvas(t){let e;if(t?e=g.from(t):this.width&&this.height&&(e=new g(new d,[this.width,this.height])),e){const t=e.getDelta(),n=new f(t.x,t.y);return n.ctx.translate(-this.position.x,-this.position.y),this.render(n.ctx),n}return null}toImage(t){const e=this.getTaintedCanvas(t);return e?e.toImage():null}toJSON(){const{defaultOptions:t}=this.constructor,e={};Object.keys(this.options).forEach(n=>{const i=this.options[n];(i&&i.equals?i.equals(t[n]):Object.is(i,t[n]))||(e[n]=i)});const n={constructor:this.constructor.name,position:this.position};return this.children.length&&(n.children=this.children.map(t=>t.toJSON())),Object.keys(e).length&&(n.options=e),n}clone(){return this.constructor.from(this.toJSON())}static from(t){return new k(t.position,t.options)}static get defaultOptions(){return{shown:!0,opacity:null,rotation:0,rotationAnchor:new d(0,0),zIndex:1,clip:null}}static get events(){return{...super.events,attach:"attach",detach:"detach",draw:"draw"}}static get ITSELF(){return"itself"}}class M extends k{constructor(t,e){super(t,e),this.isClicked=!1,this.isHovered=!1}makePath(t){const e=new window.Path2D;return this.trace(e),this.options.fill&&(t.fillStyle=this.options.fill.toString(),t.fill(e)),this.options.stroke&&this.options.strokeWidth&&(t.lineJoin=this.options.join,t.lineCap=this.options.cap,t.strokeStyle=this.options.stroke.toString(),t.lineWidth=this.options.strokeWidth,t.stroke(e)),e}trace(){throw new ReferenceError(`Unimplemented trace function in ${this.constructor.name}`)}isHover(t,e=(new f).ctx){if(!this.options.shown)return!1;const n=d.from(t).clone().subtract(this.position),i=n.clone().rotate(-this.options.rotation,this.options.rotationAnchor),s=new window.Path2D;this.trace(s);let r=this.options.fill&&e.isPointInPath(s,i.x,i.y)||this.options.stroke&&this.options.strokeWidth&&e.isPointInStroke(s,i.x,i.y);if(this.options.clip){const t=this.options.clip===k.ITSELF?this:this.options.clip;r=r&&t.isHover(n,e)}return r}static get defaultOptions(){return{...super.defaultOptions,fill:"#000",stroke:null,strokeWidth:2,cursor:M.cursors.default,join:M.joins.miter}}static get cursors(){const t={default:"default",none:"none",contextMenu:"context-menu",help:"help",pointer:"pointer",progress:"progress",wait:"wait",cell:"cell",crosshair:"crosshair",text:"text",textVertical:"vertical-text",alias:"alias",copy:"copy",move:"move",noDrop:"no-drop",notAllowed:"not-allowed",allScroll:"all-scroll",colResize:"col-resize",rowResize:"row-resize",nResize:"n-resize",eResize:"e-resize",sResize:"s-resize",wResize:"w-resize",neResize:"ne-resize",seResize:"se-resize",swResize:"sw-resize",nwResize:"nw-resize",ewResize:"ew-resize",nsResize:"ns-resize",neswResize:"nesw-resize",nwseResize:"nwse-resize",zoomIn:"zoom-in",zoomOut:"zoom-out"};return t.grab=window.CSS&&window.CSS.supports("cursor","grab")?"grab":"-webkit-grab",t.grabbing=window.CSS&&window.CSS.supports("cursor","grabbing")?"grabbing":"-webkit-grab",t.link=t.alias,t.verticalResize=t.rowResize,t.horizontalResize=t.colResize,t.topResize=t.nResize,t.rightResize=t.eResize,t.bottomResize=t.sResize,t.leftResize=t.wResize,t}static get joins(){return{miter:"miter",round:"round",bevel:"bevel"}}}const O=Symbol("_listenForEvents");class z extends k{constructor(t=window.document.body,e){super(void 0,e);const n=t.getBoundingClientRect();let i;t instanceof window.HTMLCanvasElement?i=t:(i=window.document.createElement("canvas"),t.appendChild(i),i.style.display="block",i.style.position="absolute",i.width=t.scrollWidth,i.height=t.scrollHeight),this.ctx=i.getContext("2d"),this.cursorPosition=new d,this.containerPosition=new d(n.left+window.scrollX,n.top+window.scrollY),this.isScene=!0,this.isLooped=!1,this.fps=0,this.lastTick=null,this[O](t)}setCursor(t=M.cursors.default){return this.ctx.canvas.style.cursor=t,this}render(t=this.ctx){const e=this.isLooped?window.requestAnimationFrame(this.render.bind(this,void 0)):null,n=t&&t.ctx||t;this.clear(n);try{super.render(n)}catch(t){throw window.cancelAnimationFrame(e),this.stopLoop(),t}const i=window.performance.now();return this.isLooped&&this.lastTick&&(this.fps=1e3/(i-this.lastTick)),this.lastTick=i,this}isHover(){return this.options.shown}clear(t=this.ctx){return t.clearRect(0,0,t.canvas.width,t.canvas.height),this.options.fill&&(t.fillStyle=this.options.fill,t.fillRect(0,0,t.canvas.width,t.canvas.height)),this}startLoop(){return this.isLooped=!0,this.render(),this}stopLoop(){return this.isLooped=!1,this.fps=0,this}hide(){return this.ctx.canvas.style.visibility="hidden",super.hide()}show(){return this.ctx.canvas.style.visibility="",super.show()}get width(){return this.ctx.canvas.width}get height(){return this.ctx.canvas.height}get center(){return new d(this.width/2,this.height/2)}getRandomPosition(){return new d(o(this.width),o(this.height))}static from(t){return new z(void 0,t.options)}static get defaultOptions(){return{...super.defaultOptions,fill:null,opacity:1,cursor:M.cursors.default}}}z.prototype[O]=function(t){if(this.isReady)throw new EvalError("Can't rebind event a second time.");let e=null,n=null;const i={[m.events.down]:(t,e)=>{t.isClicked=!0,n=e},[m.events.move]:(t,i)=>{n&&(t.isClicked=i.distance(n)<10),t!==e&&(e&&(e.isHovered=!1,e.isAncestorOf(t)||e.fire(new m(m.events.leave,e,i))),e=t),t.isHovered||(t.isHovered=!0,t.fire(new m(m.events.hover,t,i))),this.setCursor(t.options.cursor),this.cursorPosition.set(i)},[m.events.up]:(t,e)=>{n=null,t.isClicked&&t.fire(new m(m.events.click,t,e)),t.isClicked=!1},[m.events.wheel]:(t,e,n)=>{const i=m.events,s=n.deltaY>0?[i.scrollDown,i.zoomOut]:[i.scrollUp,i.zoomIn];t.fire(new m(s[0],t,e)).fire(new m(s[1],t,e))},mouseout:(t,e)=>{t.fire(new m(m.events.leave,t,e))}};Object.keys(i).forEach(e=>{t.addEventListener(e,t=>{if(this.options.shown){const n=new d(t.clientX,t.clientY).subtract(this.containerPosition).add(window.scrollX,window.scrollY),s=this.getTarget(n,this.ctx);s&&(s.fire(new m(e,s,n)),i[e]instanceof Function&&i[e](s,n,t))}},{passive:!0})});const s={[b.events.down]:null,[b.events.up]:null};Object.keys(s).forEach(e=>{t.addEventListener(e,t=>{this.options.shown&&(this.fire(new b(e,this,t.key)),s[e]instanceof Function&&s[e](t))})})};class S extends M{constructor(t,e,n){super(t,n);const i=e.slice(0,2).every(t=>void 0===t||"number"==typeof t)?[d.from(e)]:e.map(t=>d.from(t));this.points=i}trace(t){return t.moveTo(0,0),this.points.forEach(e=>t.lineTo(e.x,e.y)),this}isHover(){return!1}toJSON(){const{points:t}=this;return{...super.toJSON(),points:t}}static from(t){return new S(t.position,t.points,t.options)}static get defaultOptions(){const t={...super.defaultOptions,cap:S.caps.round,join:S.joins.round,fill:null,cursor:null};return t.stroke=super.defaultOptions.fill,t}static get caps(){return{butt:"butt",round:"round",square:"square"}}}class R extends M{constructor(t,e=0,n=0,i=0,s=.5,r){super(t,r),this.horizontalRadius=e,this.verticalRadius=n,this.startAngle=i,this.endAngle=s}trace(t){const e=(this.startAngle+-.25)*h,n=(this.endAngle+-.25)*h;return t.ellipse(0,0,this.horizontalRadius,this.verticalRadius,0,e,n),this}toJSON(){const{horizontalRadius:t,verticalRadius:e,startAngle:n,endAngle:i}=this;return{...super.toJSON(),horizontalRadius:t,verticalRadius:e,startAngle:n,endAngle:i}}static from(t){return new R(t.position,t.horizontalRadius,t.verticalRadius,t.startAngle,t.endAngle,t.options)}static get defaultOptions(){return{...S.defaultOptions,join:null}}static get caps(){return S.caps}}class E extends R{constructor(t,e,n,i){super(t,e,n,0,1,i)}toJSON(){const t=super.toJSON();return delete t.startAngle,delete t.endAngle,t}static from(t){return new E(t.position,t.horizontalRadius,t.verticalRadius,t.options)}static get defaultOptions(){return M.defaultOptions}}class A extends E{constructor(t,e,n){super(t,e,e,n)}get radius(){return this.horizontalRadius}set radius(t){this.horizontalRadius=t,this.verticalRadius=t}trace(t){return t.arc(0,0,this.radius,0,h),this}toJSON(){const{radius:t}=this,e={...super.toJSON(),radius:t};return delete e.horizontalRadius,delete e.verticalRadius,e}static from(t){return new A(t.position,t.radius,t.options)}}class P extends S{constructor(t,e,n=P.defaultTension,i){super(t,e,i),this.tension=n}trace(t){return 1===this.points.length||r(this.tension,0)?super.trace(t):(t.moveTo(0,0),P.splineThrough(t,[new d(0,0)].concat(this.points),this.tension)),this}toJSON(){const{tension:t}=this;return{...super.toJSON(),tension:t}}static from(t){return new P(t.position,t.points,t.tension,t.options)}static get defaultTension(){return.2}static splineThrough(t,e,n=P.defaultTension){if(e.length<2)throw new RangeError(`Need at least 2 points to spline, but only ${e.length} given.`);const i=e.map(t=>d.from(t));if(2===i.length)return void t.lineTo(i[1].x,i[1].y);const s=P.getControlPoint;let r=[null,i[0]];for(let e=1,o=i.length;e<o;++e){const a=e<o-1?s(i.slice(e-1,e+2),n):[i[e],null];t.bezierCurveTo(r[1].x,r[1].y,a[0].x,a[0].y,i[e].x,i[e].y),r=a}}static getControlPoint(t,e=P.defaultTension){if(t.length<3)throw new RangeError(`Need exactly 3 points to compute control points, but ${t.length} given.`);const n=t.map(t=>d.from(t)),i=n[2].clone().subtract(n[0]).multiply(e);return[n[1].clone().subtract(i),n[1].clone().add(i)]}}class T extends M{constructor(t,e=[],n){if(e.length<2)throw new RangeError(`A polygon can't have less than 3 vertices, but only ${e.length} given.`);super(t,n),this.points=e.map(t=>d.from(t))}trace(t){return this.points.concat([new d]).concat(...this.points.slice(0,2)).forEach(e=>t.lineTo(e.x,e.y)),this}toJSON(){const{points:t}=this;return{...super.toJSON(),points:t}}static from(t){return new T(t.position,t.points,t.options)}}class H extends T{constructor(t,e,n=0,i){super(t,H.getRotatingPoints(e,n),i),this.radius=n}trace(t){return this.points.concat(...this.points.slice(0,2)).forEach(e=>t.lineTo(e.x,e.y)),this}toJSON(){const{points:t,radius:e}=this,n={...super.toJSON(),nbSides:t.length,radius:e};return delete n.points,n}static from(t){return new H(t.position,t.nbSides,t.radius,t.options)}static getRotatingPoints(t,e,n=0){const i=n-.25,s=[];for(let n=0;n<t;++n){const r=(n/t+i)*Math.PI*2;s.push(new d(Math.cos(r)*e,Math.sin(r)*e))}return s}}class I extends M{constructor(t,e=0,n=0,i){super(t,i),this.width=e,this.height=n}trace(t){const e=this.getOriginPosition();return t.rect(-e.x,-e.y,this.width,this.height),this}getOriginPosition(){try{return d.from(this.options.origin)}catch(t){const{origin:e}=this.options,{origins:n}=I,i=new d;return e===n.center?i.set(this.width/2,this.height/2):i.set([n.topRight,n.bottomRight].includes(e)&&this.width||0,[n.bottomLeft,n.bottomRight].includes(e)&&this.height||0),i}}toJSON(){const{width:t,height:e}=this;return{...super.toJSON(),width:t,height:e}}static from(t){return new I(t.position,t.width,t.height,t.options)}static get defaultOptions(){return{...super.defaultOptions,origin:I.origins.topLeft}}static get origins(){return{topLeft:"topLeft",topRight:"topRight",center:"center",bottomLeft:"bottomLeft",bottomRight:"bottomRight"}}}class N extends I{constructor(t,e,n){super(t,e,e,n)}set size(t){this.width=t,this.height=t}get size(){return this.width}toJSON(){const{size:t}=this,e={...super.toJSON(),size:t};return delete e.height,delete e.width,e}static from(t){return new N(t.position,t.size,t.options)}}Symbol("_url");var j=function(t){return document.defaultView.getComputedStyle(t||document.body).direction},C=n(3),J=n.n(C);function D(t){return Array.isArray(t)?t.reduce((t,e)=>t.concat(e.split("\n")),[]):t.split("\n")}const L=(()=>{const{ctx:t}=new f,e={};return(n,i)=>{const s=J()(`${n}${i}`);if(void 0!==e[s])return e[s];t.font=i;const r=t.measureText(n),o={width:r.width,height:r.emHeightAscent+r.emHeightDescent};return e[s]=o,o}})();class q extends M{constructor(t,e="",n){super(t,n),this.lines=[],this.text=e;const i=new v(v.events.ready,this);/^(\w+:)?\/\//.test(this.options.font)?q.load(this.options.font).then(t=>{this.options.font=t,this.fire(i)}):this.fire(i)}get text(){return this.lines.join("\n")}set text(t){this.lines=D(t)}makePath(t){if(this.text.length){const e=this.options;t.font=q.getFontDefinition(e),t.textAlign=e.align,t.textBaseline="top";const{height:n}=L("M",t.font),i=n*e.lineHeight,s=n*((e.lineHeight-1)/2);e.fill&&(t.fillStyle=e.fill),e.stroke&&(t.strokeStyle=e.stroke,t.lineWidth=e.strokeWidth),e.underscore&&t.beginPath(),this.lines.forEach((r,o)=>{const a=o*i+s;if(e.fill&&t.fillText(r,0,a),e.stroke&&t.strokeText(r,0,a),e.underscore){const{width:e}=L(r,t.font);t.moveTo(0,a+n),t.lineTo(e,a+n)}}),e.underscore&&(t.lineWidth=.05*n,t.strokeStyle=e.fill||e.stroke,t.stroke(),t.closePath())}return this}isHover(t){if(!this.options.shown)return!1;const{width:e,height:n}=this.getMeasures(),i=this.getOriginPosition().add(d.from(t));return this.position.x<=i.x&&i.x<=this.position.x+e&&this.position.y<=i.y&&i.y<=this.position.y+n}getOriginPosition(){const{align:t}=this.options;let e=0;if(t===q.alignments.center)e=this.width/2;else if(t===q.alignments.right)e=this.width;else if(t===q.alignments.start||t===q.alignments.end){const n=this.getRoot();if(n.isScene){const i=j(n.ctx.canvas);(t===q.alignments.start&&"rtl"===i||t===q.alignments.end&&"ltr"===i)&&(e=this.width)}}return new d(e,0)}getMeasures(){return q.measure(this.lines,this.options)}get width(){return this.getMeasures().width}get height(){return this.getMeasures().height}toJSON(){const{text:t}=this;return{...super.toJSON(),text:t}}static from(t){return new q(t.position,t.text,t.options)}static load(t){if(Array.isArray(t))return Promise.all(t.map(t=>q.load(t)));const e=t.replace(/\W/g,"-"),n=new window.FontFace(e,`url(${t})`);return window.document.fonts.add(n),n.load().then(()=>e)}static getFontDefinition(t){return`${t.bold?"bold ":""}${t.italic?"italic ":""}${t.fontSize}px ${t.font}`}static measure(t,e){const n={...this.defaultOptions,...e},i=D(t),s=this.getFontDefinition(n);return{width:Math.max(...i.map(t=>L(t,s).width)),height:L("M",s).height*i.length*n.lineHeight}}static get defaultOptions(){return{...super.defaultOptions,font:"sans-serif",fontSize:20,align:q.alignments.start,bold:!1,italic:!1,lineHeight:1,underscore:!1}}static get alignments(){return{left:"left",right:"right",center:"center",start:"start",end:"end"}}}class $ extends k{constructor(t,e){super(t,e),this.background=new I([0,0],0,0,{fill:this.options.background,stroke:this.options.border,strokeWidth:2,cursor:M.cursors.pointer}),this.add(this.background),this.background.on(m.events.hover,()=>{this.background.options.fill=this.options.hover}).on(m.events.leave,()=>{this.background.options.fill=this.options.background}).on(m.events.click,t=>{this.click(t.position.clone().subtract(this.position))}),this.on(k.events.attach,()=>this.value=this.options.value,!0)}get value(){throw new ReferenceError(`Unimplemented get value function in ${this.constructor.name}`)}set value(t){throw new ReferenceError(`Unimplemented set value function in ${this.constructor.name}`)}click(){this.fire(new w($.events.change,this))}isHover(t,e){return this.options.shown&&this.background.isHover(this.position.clone().add(t),e)}toJSON(){const t=super.toJSON();return t.options=t.options||{},t.options.value=this.value,t.children=t.children.slice(1),t}static from(t){return new this(t.position,t.options)}static get defaultOptions(){return{...super.defaultOptions,value:null,fill:"#444",background:"#f6f6f6",border:"#aaa",hover:"#dcdcdc"}}static get events(){return{...super.events,change:"change"}}}M.prototype.draggable=function(t){const e=this.options.cursor===M.cursors.default;e&&(this.options.cursor=M.cursors.grab),this.isDraggable=!0;const n={x:!0,y:!0,...t};let i=null,s=null;return this.on(m.events.down,t=>{e&&(this.options.cursor=M.cursors.grabbing),i=t.position,s=this.position.clone(),this.isDragged=!0,this.fire(new m(m.events.grab,this,this.position))},!0),this.getScene().then(t=>t.on(m.events.move,t=>{if(this.isDragged&&i){const e=t.position.clone().subtract(i),r=s.clone().add(n.x&&e.x,n.y&&e.y);this.position.set(r),n.constrain&&this.position.constrain(n.constrain.start,n.constrain.end),this.fire(new m(m.events.drag,this,this.position))}}).on(m.events.up,()=>{e&&(this.options.cursor=M.cursors.grab),this.isDragged=!1,i=null,this.fire(new m(m.events.drop,this,this.position))})),{set x(t){n.x=t},set y(t){n.y=t},set constrain(t){n.constrain=t}}};const F=Symbol("_constrainer"),G=Symbol("_moveHandle");class U extends ${constructor(t,e){super(t,e),this.background.width=this.width,this.background.height=U.HEIGHT;const n=new k(new d(U.HEIGHT/2,U.HEIGHT/2));this.background.add(n),this.handle=new A(new d(0,0),(U.HEIGHT-2)/2,{fill:this.options.fill,cursor:M.cursors.ewResize}),n.add(this.handle),this[F]=new g(new d(0,0),new d(this.width-U.HEIGHT,0)),this.handle.draggable({constrain:this[F]}),this.handle.on(m.events.drag,()=>this.fire(new w(U.events.change,this)),!0)}click(t){this.handle.position.set(t.x-U.HEIGHT/2,0).constrain(this[F].start,this[F].end),super.click()}set width(t){if(t<U.HEIGHT)throw new RangeError(`Slider is too small, minimum is ${U.HEIGHT}px.`);this.options.width=t,this.background.width=t,this[F].end=new d(this.width-U.HEIGHT,0),this[G](this.value)}get width(){return this.options.width}get value(){const t=this.options.max-this.options.min,e=this.handle.position.x/(this.width-U.HEIGHT);return this.options.min+t*e}set value(t){this[G](s(t,this.options.min,this.options.max))}static get defaultOptions(){return{...super.defaultOptions,min:0,max:10,width:200}}static get HEIGHT(){return 20}}U.prototype[G]=function(t){const e=this.options.max-this.options.min;this.handle.position.x=(this.width-U.HEIGHT)*((t-this.options.min)/e)};Symbol("_value");I.prototype.resizable=function(t){this.isResizable=!0;const e={x:!0,y:!0,handle:new T([this.width,this.height],[[-15,0],[0,-15]],{fill:"gold",cursor:M.cursors.seResize}),...t};if((!e.x||!e.y)&&this instanceof N)throw new TypeError("Square should be resizable in both x and y axis.");this.add(e.handle);const n=e.handle.position.clone().multiply(-1).add(this.width,this.height),i=e.handle.draggable(e);return e.handle.on(m.events.drag,()=>{this instanceof N?(e.handle.position.add(n),this.size=(e.handle.position.x+e.handle.position.y)/2,e.handle.position.set(this.size).subtract(n)):(e.x&&(this.width=e.handle.position.x+n.x),e.y&&(this.height=e.handle.position.y+n.y)),this.fire(new m(m.events.resize,this,e.handle.position))},!0),i};var W=n(0);W.c,W.a,W.b;class _ extends P{constructor(t,e){super(t.position,[],.2,{stroke:"#333",zIndex:-10}),this.from=t,this.to=e,this.middle=this.getCenter()}getCenter(){return this.position.clone().lerp(this.to.position,.5)}trace(...t){const e=this.getCenter();this.middle.lerp(e,.1),this.points=[this.middle,this.to.position].map(t=>t.clone().subtract(this.position)),this.children.forEach(t=>{t.position.lerp(t.options.destination,.08),t.position.distance(t.options.destination)<t.radius&&t.delete()}),super.trace(...t)}getOther(t){return t===this.from?this.to:t===this.to?this.from:null}sendFrom(t){const e=this.getOther(t);e.value+=1;const n=new A(t.position.clone().subtract(this.position),10,{fill:"#99ff66",stroke:"#333",zIndex:-5,destination:e.position.clone().subtract(this.position)});this.add(n)}}const Y="#333",B=Symbol("_value");class X extends A{constructor(t,e,n=0){super(t,e,{stroke:Y});const i=e/2,s=new A([0,4-i],i,{fill:"#fff",stroke:Y,cursor:"pointer"});this.text=new q([0,-i/2],"0",{align:q.alignments.center,fill:Y,fontSize:i,cursor:"pointer"}),s.add(this.text),this.add(s),this.links=[],this[B]=null,this.value=n,this.on("click",()=>this.click()),this.draggable()}click(){this.value-=this.links.length,this.links.forEach(t=>t.sendFrom(this)),this.fire(new w("lends",this))}delete(){this.links.forEach(t=>t.delete()),super.delete()}get value(){return this[B]}set value(t){this[B]=Math.round(t),this.text.text=this[B].toString(),this[B]<0?this.options.fill="#ff7365":this.options.fill="#99ff66"}linkTo(t){if(t&&!this.links.find(e=>e.getOther(this)===t)){const e=new _(this,t);return this.links.push(e),t.links.push(e),e}return null}toJSON(){const{position:t,links:e,value:n}=this;return{position:t,links:e,value:n}}}function V(t,e=[],n=0){return{position:d.from(t),links:e,value:n}}const K=localStorage,Q=btoa,Z=atob;const tt=t=>{const e=Q(function(t){return Math.random().toString(36).slice(-t)}(7)+Q(JSON.stringify(t)));K.setItem("socsim",e)};class et{constructor(){this.nodes=[]}isWon(){return!this.nodes.find(t=>t.value<0)}get(t){return this.nodes[t]}add(t){return this.nodes.push(t),this}magnetic(){const t=3*this.nodes[0].radius;this.nodes.forEach(e=>{if(!e.isDragged){const n=this.nodes.reduce((n,i)=>{const s=e.position.distance(i.position);return i!==e&&s<t&&n.add(e.position.clone().subtract(i.position).multiply((t-s)**2)),n},new d(0,0));e.position.add(n.divide(3e5))}})}toJSON(){const t=this.nodes.map(t=>t.toJSON());return t.forEach((t,e)=>{t.links=t.links.map(t=>this.nodes.indexOf(t.getOther(this.get(e))))}),t}static getNoduleRadius(t,e){return Math.min(...e)/(t**.5*2)}}function nt(t){return new d(i.random(-t[0],t[0]),i.random(-t[1],t[1]))}document.getElementById("scene");const it=new z(void 0,{fill:"#f5f5f5"}),st=.1*Math.min(it.width,it.height),rt=[it.width/2-st,it.height/2-st],ot=Math.floor(it.width*it.height/12e4),at=(()=>{const t=K.getItem("socsim");if(!t)return{};const e=Z(Z(t).slice(7));return JSON.parse(e)})();let ht,lt=at.mv||0,ct=at.cl||0,ut=at.df||0;const dt=new k(it.center);function pt(t){dt.empty(),ht=t?function(t,e){const n=et.getNoduleRadius(t.length,e),i=new et;for(let e=0,s=t.length;e<s;++e){const s=t[e],r=new X(s.position,n,s.value);s.links.filter(t=>t<e).map(t=>r.linkTo(i.nodes[t])),i.add(r)}return i}(t,rt):function(t,e,n){const s=et.getNoduleRadius(e,t),r=new et;let o=0;for(let n=0;n<e;++n){let e;const n=()=>r.nodes.find(t=>t.position.distance(e)<2*s);do{e=nt(t)}while(n());const a=new X(e,s);r.nodes.map((t,e)=>e).filter(t=>r.get(t).links.length<3).sort((t,n)=>r.get(t).position.distance(e)-r.get(n).position.distance(e)).slice(0,Math.round(i.random(1)+1)).forEach(t=>a.linkTo(r.get(t))),o+=a.links.length,r.add(a)}const a=Math.ceil(e**.5);let h=0;r.nodes.slice(1).forEach(t=>{const e=Math.round(i.random(2*a)-a);t.value=e,h+=e});const l=o-e+1,c=e/2*n;return r.get(0).value=l-h+c,r}(rt,Math.floor(ot+ut),1-ut%1);for(let t=0,e=ht.nodes.length;t<e;++t){const e=ht.get(t);dt.add(...e.links,e)}}it.add(dt);const gt=[[V([-100,0],[1],1),V([100,0],[0],-1)],[V([-300,0],[1],2),V([0,0],[0,2],-4),V([300,0],[1],2)],(()=>{let t=0;const e=H.getRotatingPoints(3,200);return[V(e[t++],[1,2],3),V(e[t++],[0,2],-2),V(e[2],[0,1],1)]})(),(()=>{const t=H.getRotatingPoints(5,200);return[V([0,0],[],30),...t.map(t=>V(t,[0],-5))]})(),(()=>{let t=0;const e=H.getRotatingPoints(8,200);return[V(e[t++],[],5),V(e[t++],[t-2],1),V(e[t++],[t-2],1),V(e[t++],[t-2],1),V(e[t++],[t-2],-2),V(e[t++],[t-2],1),V(e[t++],[t-2],1),V(e[t++],[t-2,0],1)]})()];pt(at.gr||gt[ct]);const ft=new I([0,0],it.width,it.height,{fill:"#111",opacity:.5,zIndex:10}),wt=new q(it.center.subtract(0,70),"",{fill:"red",fontSize:70,align:"center",opacity:1,rotationAnchor:[0,35]});ft.add(wt);const mt=new q([10,10],`Level: ${ct}`,{fill:"#666"});function vt(t){tt({cl:ct,df:ut,gr:!t&&ht,mv:!t&&lt})}it.add(mt),ft.on("click",()=>{ft.delete(),lt=0,pt(gt[ct]),mt.text=`Level: ${ct}`,vt()}),it.on("lends",()=>{lt++,ht.isWon()?(it.add(ft),wt.text=`You won in ${lt} moves !`,gt[ct]||(ut+=.6),ct++,vt(!0)):vt()}).on("draw",()=>{ft.options.shown&&(wt.options.rotation=Math.cos(wt.frameCount/20)/50),ht.magnetic()},!0).startLoop()}]);