!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=2)}([function(t){t.exports={a:{name:"Guillaume Martigny",email:"guillaume.martigny@gmail.com",url:"https://www.guillaume-martigny.fr"},b:"https://github.com/GMartigny/pencil.js#readme",c:"1.0.1"}},function(t,e,i){
//! stable.js 0.1.8, https://github.com/Two-Screen/stable
//! Â© 2018 Angry Bytes and contributors. MIT licensed.
t.exports=function(){"use strict";var t=function(t,i){return e(t.slice(),i)};function e(t,e){"function"!=typeof e&&(e=function(t,e){return String(t).localeCompare(e)});var s=t.length;if(s<=1)return t;for(var n=new Array(s),o=1;o<s;o*=2){i(t,e,o,n);var r=t;t=n,n=r}return t}t.inplace=function(t,s){var n=e(t,s);return n!==t&&i(n,null,t.length,t),t};var i=function(t,e,i,s){var n,o,r,h,a,c=t.length,l=0,u=2*i;for(n=0;n<c;n+=u)for(r=(o=n+i)+i,o>c&&(o=c),r>c&&(r=c),h=n,a=o;;)if(h<o&&a<r)e(t[h],t[a])<=0?s[l++]=t[h++]:s[l++]=t[a++];else if(h<o)s[l++]=t[h++];else{if(!(a<r))break;s[l++]=t[a++]}};return t}()},function(t,e,i){"use strict";i.r(e);var s={};i.r(s),i.d(s,"constrain",function(){return n}),i.d(s,"equals",function(){return o}),i.d(s,"random",function(){return r}),i.d(s,"truncate",function(){return h}),i.d(s,"radianCircle",function(){return a}),i.d(s,"degreeCircle",function(){return c}),i.d(s,"modulo",function(){return l});const n=(t,e,i)=>Math.min(Math.max(t,e),i),o=(t,e)=>Math.abs(t-e)<Number.EPSILON,r=(t=1,e)=>{let i=t,s=e;return void 0===e&&(i=0,s=t),Math.random()*(s-i)+i},h=t=>t<<0,a=2*Math.PI,c=360,l=(t,e)=>t%e*Math.sign(t)*Math.sign(e);class u{constructor(t=0,e=0){this.x=+t,this.y=+e}set(t,e){let i,s;try{const n=u.from(t);({x:i,y:s}=n)}catch(n){i=+t,s=void 0===e?i:+e}return this.x=i,this.y=s,this}clone(){return new u(this.x,this.y)}equals(t){const e=u.from(t);return o(this.x,e.x)&&o(this.y,e.y)}calc(t,e,i){let s=0,n=0;try{const o=u.from(e);s=t(this.x,o.x),n=t(this.y,o.y)}catch(o){s=t(this.x,+e),n=t(this.y,void 0===i?+e:+i)}return this.set(s,n)}add(t,e){return this.calc((t,e)=>t+e,t,e)}subtract(t,e){return this.calc((t,e)=>t-e,t,e)}multiply(t,e){return this.calc((t,e)=>t*e,t,e)}divide(t,e){return this.calc((t,e)=>t/e,t,e)}rotate(t=0,e){const{cos:i,sin:s}=Math,n=t*a,o=u.from(e),r=this.clone().subtract(o),h=r.x*i(n)-r.y*s(n),c=r.y*i(n)+r.x*s(n);return this.set(h,c).add(o)}constrain(t,e){const i=u.from(t),s=u.from(e),o=n(this.x,i.x,s.x),r=n(this.y,i.y,s.y);return this.set(o,r)}lerp(t,e){const i=u.from(t).clone().subtract(this).multiply("function"==typeof e?e():e);return this.add(i)}distance(t){const e=u.from(t);return Math.hypot(e.x-this.x,e.y-this.y)}crossProduct(t){const e=u.from(t);return this.x*e.y-e.x*this.y}isOnSameSide(t,e){const i=u.from(t),s=this.clone().subtract(e.start),n=i.clone().subtract(e.start),o=e.getDelta(),{sign:r}=Math;return r(s.crossProduct(o))===r(n.crossProduct(o))}toJSON(){return[h(this.x),h(this.y)]}static from(t=new u){if(t instanceof u)return t;if(Array.isArray(t)&&2===t.length&&"number"==typeof t[0]&&"number"==typeof t[1])return new u(...t);if("Object"===t.constructor.name)return new u(t.x,t.y);throw new TypeError(`Unexpected type for position: ${t}.`)}static average(...t){let e=new u;t.forEach(t=>e=e.add(u.from(t)));const i=t.length;return e.divide(i)}}function d(t){let e;try{e=p.from(t).getDelta()}catch(i){e=t.getDelta?t.getDelta():t}return e}class p{constructor(t,e){this.start=u.from(t),this.end=u.from(e)}get width(){return Math.abs(this.start.x-this.end.x)}get height(){return Math.abs(this.start.y-this.end.y)}length(){return this.start.distance(this.end)}clone(){return new p(this.start.clone(),this.end.clone())}equals(t){const e=p.from(t);return this.start.equals(e.start)&&this.end.equals(e.end)}getDelta(){return this.end.clone().subtract(this.start)}add(t){const e=d(t);return this.end.add(e),this}translate(t){const e=d(t);return this.start.add(e),this.end.add(e),this}multiply(t){if("number"==typeof t)return this.add(this.getDelta().multiply(t-1)),this;const e=d(t);return this.end.multiply(e),this}intersect(t){const e=p.from(t);return!(this.start.isOnSameSide(this.end,e)||e.start.isOnSameSide(e.end,this))}toJSON(){return[this.start.toJSON(),this.end.toJSON()]}static from(t=new p){if(t instanceof p)return t;if(Array.isArray(t)&&2===t.length&&Array.isArray(t[0])&&Array.isArray(t[1]))return new p(...t);if("Object"===t.constructor.name)return new p(t.start,t.end);throw new TypeError(`Unexpected type for vector [${typeof t}]`)}}class g{constructor(t=1,e=1){this.canvas=window.document.createElement("canvas"),this.setSize(t,e),this.ctx=this.canvas.getContext("2d")}setSize(t,e){this.canvas.width=+t,this.canvas.height=+e}render(t){return this.clear(),t.render(this.ctx),this}clear(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)}set imageData(t){this.ctx.putImageData(t,0,0)}get imageData(){return this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height)}toImg(t="image/png"){const e=window.document.createElement("img");return e.src=this.canvas.toDataURL(t),e}}class f{constructor(t,e){this.target=t,this.name=e}}class w extends f{constructor(t,e,i){super(t,e),this.position=u.from(i)}static get events(){return{down:"mousedown",up:"mouseup",click:"click",move:"mousemove",hover:"hover",leave:"leave",wheel:"mousewheel",scrollDown:"scrolldown",scrollUp:"scrollup",zoomOut:"zoomout",zoomIn:"zoomin",grab:"grab",drag:"drag",drop:"drop",resize:"resize"}}}class m extends f{constructor(t,e,i){super(t,e),this.key=i}static get events(){return{down:"keydown",up:"keyup"}}static get keys(){return{backspace:"Backspace",enter:"Enter",delete:"Delete",escape:"Escape",control:"Control",shift:"Shift",arrows:{up:"ArrowUp",right:"ArrowRight",down:"ArrowDown",left:"ArrowLeft"},tab:"Tab",alt:"Alt",altGr:"AltGraph",pageUp:"PageUp",pageDown:"PageDown",start:"Home",end:"End",insert:"Insert"}}}class v{constructor(){this.eventListeners={}}on(t,e,i=!1){return this.eventListeners[t]||(this.eventListeners[t]=[]),this.eventListeners[t].push({callback:e,element:this,isTargeted:i}),this}fire(t){const e=this.eventListeners[t.name];return e&&e.length&&e.forEach(e=>{e.isTargeted&&e.element!==t.target||e.callback.call(this,t)}),this}clone(){return this.constructor.from(this.toJSON())}toJSON(){return{constructor:this.constructor.name}}static from(){throw new ReferenceError(`Unimplemented from function in ${this.name}`)}}var b=i(1),x=i.n(b);class y extends v{constructor(t=new u,e){super(),this.position=u.from(t),this.options=Object.assign(this.constructor.defaultOptions,e),this.options.rotationAnchor=u.from(this.options.rotationAnchor),this.children=[],this.parent=null,this.frameCount=0,this._scenePromise=new Promise(t=>{this.on(y.events.attach,()=>{const e=this.getRoot();e.isScene?t(e):e.getScene().then(e=>t(e))})})}isHover(){return!1}add(...t){return t.forEach(t=>{if(t===this)throw new RangeError("A container can't contain itself.");if(t.isScene)throw new RangeError("A scene can't be contained in another container.");t.parent&&t.parent.removeChild(t),t.parent=this,this.children.push(t),t.fire(new f(t,y.events.attach))}),this}removeChild(...t){return t.forEach(t=>{if(this.children.includes(t)){const e=this.children.splice(this.children.indexOf(t),1)[0];e.parent=null,e.fire(new f(e,y.events.detach))}}),this}empty(){return this.removeChild(...this.children)}remove(){return this.parent&&this.parent.removeChild(this),this}getScene(){return this._scenePromise}getRoot(){return this.parent?this.parent.getRoot():this}getAbsolutePosition(){const t=new u;return this.climbAncestry(e=>{t.rotate(e.options.rotation,e.options.rotationAnchor).add(e.position)}),t}fire(t){return super.fire(t),this.parent&&this.parent.fire(t),this}getTarget(t,e){const i=t.clone().subtract(this.position);let s=null,n=this.children.length-1;for(;!s&&n>=0;)s=this.children[n].getTarget(i,e),--n;return s?s.options.zIndex<0&&this===s.parent&&this.isHover(t,e)&&this||s:this.isHover(t,e)&&this||null}render(t){if(!this.options.shown)return this;if(this.frameCount++,this.fire(new f(this,y.events.draw)),t.save(),t.translate(this.position.x,this.position.y),this.options.clip){const e=new Path2D,i=this.options.clip===y.ITSELF?this:this.options.clip,{x:s,y:n}=i.position;t.translate(s,n),i.trace&&i.trace(e),t.clip(e),t.translate(-s,-n)}if(this.options.rotation){const e=this.options.rotationAnchor.x,i=this.options.rotationAnchor.y;t.translate(e,i),t.rotate(this.options.rotation*a),t.translate(-e,-i)}x.a.inplace(this.children,(t,e)=>t.options.zIndex-e.options.zIndex),null!==this.options.opacity&&t.globalAlpha!==this.options.opacity&&(t.globalAlpha=this.options.opacity);const e=this.children.filter(t=>t.options.zIndex<0).length;for(let i=0,s=e;i<s;++i)this.children[i].render(t);this.makePath(t);for(let i=e,s=this.children.length;i<s;++i)this.children[i].render(t);return t.restore(),this}makePath(){return this}show(){return this.options.shown=!0,this}hide(){return this.options.shown=!1,this}isAncestorOf(t){return!(!t||!t.parent)&&(t.parent===this||this.isAncestorOf(t.parent))}climbAncestry(t,e){t(this),this.parent&&this.parent!==e&&this.parent.climbAncestry(t)}getTaintedCanvas(t){let e;if(t?e=p.from(t):this.width&&this.height&&(e=new p(new u,[this.width,this.height])),e){const t=e.getDelta(),i=new g(t.x,t.y);return i.ctx.translate(-this.position.x,-this.position.y),this.render(i.ctx),i}return null}toImg(t){const e=this.getTaintedCanvas(t);return e?e.toImg():null}toJSON(){const{defaultOptions:t}=this.constructor,e={};Object.keys(this.options).forEach(i=>{const s=this.options[i];(s&&s.equals?s.equals(t[i]):Object.is(s,t[i]))||(e[i]=s&&s.toJSON?s.toJSON():s)});const i=Object.assign(super.toJSON(),{position:this.position.toJSON()});return this.children.length&&(i.children=this.children.map(t=>t.toJSON())),Object.keys(e).length&&(i.options=e),i}static from(t){return new y(t.position,t.options)}static get defaultOptions(){return{shown:!0,opacity:null,rotation:0,rotationAnchor:new u(0,0),zIndex:1,clip:null}}static get events(){return{attach:"attach",detach:"detach",draw:"draw"}}static get ITSELF(){return"itself"}}class O extends y{constructor(t,e){super(t,e),this.isClicked=!1,this.isHovered=!1}makePath(t){const e=new Path2D;return this.trace(e),this.options.fill&&(t.fillStyle=this.options.fill,t.fill(e)),this.options.stroke&&this.options.strokeWidth&&(t.lineJoin=this.options.join,t.lineCap=this.options.cap,t.strokeStyle=this.options.stroke,t.lineWidth=this.options.strokeWidth,t.stroke(e)),e}trace(){throw new ReferenceError(`Unimplemented trace function in ${this.constructor.name}`)}isHover(t,e=(new g).ctx){if(!this.options.shown)return!1;const i=u.from(t).clone().subtract(this.position),s=i.clone().rotate(-this.options.rotation,this.options.rotationAnchor),n=new Path2D;this.trace(n);let o=e.isPointInPath(n,s.x,s.y)||e.isPointInStroke(n,s.x,s.y);if(this.options.clip){const t=this.options.clip===y.ITSELF?this:this.options.clip;o=o&&t.isHover(i,e)}return o}static get defaultOptions(){return Object.assign(super.defaultOptions,{fill:"#000",stroke:null,strokeWidth:2,cursor:O.cursors.default,join:O.joins.miter})}static get cursors(){const t={default:"default",none:"none",contextMenu:"context-menu",help:"help",pointer:"pointer",progress:"progress",wait:"wait",cell:"cell",crosshair:"crosshair",text:"text",textVertical:"vertical-text",alias:"alias",copy:"copy",move:"move",noDrop:"no-drop",notAllowed:"not-allowed",allScroll:"all-scroll",colResize:"col-resize",rowResize:"row-resize",nResize:"n-resize",eResize:"e-resize",sResize:"s-resize",wResize:"w-resize",neResize:"ne-resize",seResize:"se-resize",swResize:"sw-resize",nwResize:"nw-resize",ewResize:"ew-resize",nsResize:"ns-resize",neswResize:"nesw-resize",nwseResize:"nwse-resize",zoomIn:"zoom-in",zoomOut:"zoom-out"};return t.grab=window.CSS&&window.CSS.supports("cursor","grab")?"grab":"-webkit-grab",t.grabbing=window.CSS&&window.CSS.supports("cursor","grabbing")?"grabbing":"-webkit-grab",t.link=t.alias,t.verticalResize=t.rowResize,t.horizontalResize=t.colResize,t.topResize=t.nResize,t.rightResize=t.eResize,t.bottomResize=t.sResize,t.leftResize=t.wResize,t}static get joins(){return{miter:"miter",round:"round",bevel:"bevel"}}}class S extends y{constructor(t=window.document.body,e){let i;super(void 0,e),t.innerHTML="",t instanceof HTMLCanvasElement?i=t:(i=window.document.createElement("canvas"),t.appendChild(i),i.style.display="block");const s=t.getBoundingClientRect();i.width=s.width,i.height=s.height,this.ctx=i.getContext("2d"),this.cursorPosition=new u,this.containerPosition=new u(s.left+window.scrollX,s.top+window.scrollY),this.isScene=!0,this.isLooped=!1,this.fps=0,this.lastTick=null,this.isReady=!1,this._listenForEvents()}_listenForEvents(){if(this.isReady)throw new EvalError("Can't rebind event a second time.");let t=null;const e={[w.events.down]:t=>t.isClicked=!0,[w.events.move]:(e,i)=>{e.isClicked=!1,e!==t&&(t&&(t.isHovered=!1,t.isAncestorOf(e)||t.fire(new w(t,w.events.leave,i))),t=e),e.isHovered||(e.isHovered=!0,e.fire(new w(e,w.events.hover,i))),this.setCursor(e.options.cursor),this.cursorPosition.set(i)},[w.events.up]:(t,e)=>{t.isClicked&&t.fire(new w(t,w.events.click,e)),t.isClicked=!1},[w.events.wheel]:(t,e,i)=>{const s=w.events,n=i.deltaY>0?[s.scrollDown,s.zoomOut]:[s.scrollUp,s.zoomIn];t.fire(new w(t,n[0],e)).fire(new w(t,n[1],e))},mouseout:(t,e)=>{t.fire(new w(t,w.events.leave,e))}};Object.keys(e).forEach(t=>{window.addEventListener(t,i=>{const s=new u(i.clientX,i.clientY).subtract(this.containerPosition).add(window.scrollX,window.scrollY),n=this.getTarget(s,this.ctx);n&&(n.fire(new w(n,t,s)),e[t]instanceof Function&&e[t](n,s,i))},{passive:!0})});const i={[m.events.down]:null,[m.events.up]:null};Object.keys(i).forEach(t=>{window.addEventListener(t,e=>{this.fire(new m(this,t,e.key)),i[t]instanceof Function&&i[t](e)})}),this.isReady=!0}setCursor(t=O.cursors.default){return this.ctx.canvas.style.cursor=t,this}render(t){const e=this.isLooped?requestAnimationFrame(this.render.bind(this,void 0)):null,i=t&&t.ctx||t||this.ctx;this.clear(i);try{super.render(i)}catch(t){throw cancelAnimationFrame(e),t}const s=performance.now();return this.isLooped&&this.lastTick&&(this.fps=1e3/(s-this.lastTick)),this.lastTick=s,this}isHover(){return!0}clear(t=this.ctx){return t.clearRect(0,0,t.canvas.width,t.canvas.height),this.options.fill&&(t.fillStyle=this.options.fill,t.fillRect(0,0,t.canvas.width,t.canvas.height)),this}startLoop(){return this.isLooped=!0,this.render(),this}stopLoop(){return this.isLooped=!1,this.fps=0,this}hide(){return this.ctx.canvas.style.visibility="hidden",super.hide()}show(){return this.ctx.canvas.style.visibility="",super.show()}get width(){return this.ctx.canvas.width}get height(){return this.ctx.canvas.height}get center(){return new u(this.width/2,this.height/2)}getRandomPosition(){return new u(r(this.width),r(this.height))}static from(t){return new S(void 0,t.options)}static get defaultOptions(){return Object.assign(super.defaultOptions,{fill:null,opacity:1,cursor:O.cursors.default})}}class k extends O{constructor(t,e,i){let s;super(t,i);try{s=[u.from(e)]}catch(t){s=e.map(t=>u.from(t))}this.points=s}trace(t){return t.moveTo(0,0),this.points.forEach(e=>t.lineTo(e.x,e.y)),this}isHover(){return!1}toJSON(){return Object.assign(super.toJSON(),{points:this.points.map(t=>t.toJSON())})}static from(t){return new k(t.position,t.points,t.options)}static get defaultOptions(){const t=Object.assign(super.defaultOptions,{cap:k.caps.round,join:k.joins.round,fill:null,cursor:null});return t.stroke=super.defaultOptions.fill,t}static get caps(){return{butt:"butt",round:"round",square:"square"}}}class z extends O{constructor(t,e=0,i=0,s=0,n=.5,o){super(t,o),this.width=e,this.height=i,this.startAngle=s,this.endAngle=n}trace(t){const e=(this.startAngle+-.25)*a,i=(this.endAngle+-.25)*a;return t.ellipse(0,0,this.width/2,this.height/2,0,e,i),this}toJSON(){return Object.assign(super.toJSON(),{width:this.width,height:this.height,startAngle:this.startAngle,endAngle:this.endAngle})}static from(t){return new z(t.position,t.width,t.height,t.startAngle,t.endAngle,t.options)}static get defaultOptions(){return Object.assign(k.defaultOptions,{join:null})}static get caps(){return k.caps}}class R extends z{constructor(t,e,i,s){super(t,e,i,0,1,s)}toJSON(){const t=super.toJSON();return delete t.startAngle,delete t.endAngle,t}static from(t){return new R(t.position,t.width,t.height,t.options)}static get defaultOptions(){return O.defaultOptions}}class T extends R{constructor(t,e,i){super(t,2*e,2*e,i)}get radius(){return this.width/2}set radius(t){this.width=2*t,this.height=2*t}toJSON(){const t=Object.assign(super.toJSON(),{radius:this.radius});return delete t.width,delete t.height,t}static from(t){return new T(t.position,t.radius,t.options)}}class E extends k{constructor(t,e,i=E.defaultTension,s){super(t,e,s),this.tension=i}trace(t){return 1===this.points.length||o(this.tension,0)?super.trace(t):(t.moveTo(0,0),E.splineThrough(t,[new u(0,0)].concat(this.points),this.tension)),this}toJSON(){return Object.assign(super.toJSON(),{tension:this.tension})}static from(t){return new E(t.position,t.points,t.tension,t.options)}static get defaultTension(){return.2}static splineThrough(t,e,i=E.defaultTension){if(e.length<2)throw new RangeError(`Need at least 2 points to spline, but only ${e.length} given.`);const s=e.map(t=>u.from(t));if(2===s.length)return void t.lineTo(s[1].x,s[1].y);const n=E.getControlPoint;let o=[null,s[0]];for(let e=1,r=s.length;e<r;++e){const h=e<r-1?n(s.slice(e-1,e+2),i):[s[e],null];t.bezierCurveTo(o[1].x,o[1].y,h[0].x,h[0].y,s[e].x,s[e].y),o=h}}static getControlPoint(t,e=E.defaultTension){if(t.length<3)throw new RangeError(`Need exactly 3 points to compute control points, but ${t.length} given.`);const i=t.map(t=>u.from(t)),s=i[2].clone().subtract(i[0]).multiply(e);return[i[1].clone().subtract(s),i[1].clone().add(s)]}}class A extends O{constructor(t,e=[],i){if(e.length<2)throw new RangeError(`A polygon can't have less than 3 vertices, but only ${e.length} given.`);super(t,i),this.points=e.map(t=>u.from(t))}trace(t){return this.points.concat([new u]).concat(...this.points.slice(0,2)).forEach(e=>t.lineTo(e.x,e.y)),this}toJSON(){return Object.assign(super.toJSON(),{points:this.points.map(t=>t.toJSON())})}static from(t){return new A(t.position,t.points,t.options)}}class N extends A{constructor(t,e,i=0,s){super(t,N.getRotatingPoints(e,i),s),this.radius=i}trace(t){return this.points.concat(...this.points.slice(0,2)).forEach(e=>t.lineTo(e.x,e.y)),this}toJSON(){const t=Object.assign(super.toJSON(),{nbSides:this.points.length,radius:this.radius});return delete t.points,t}static from(t){return new N(t.position,t.nbSides,t.radius,t.options)}static getRotatingPoints(t,e,i=0){const s=i-.25,n=[];for(let i=0;i<t;++i){const o=(i/t+s)*Math.PI*2;n.push(new u(Math.cos(o)*e,Math.sin(o)*e))}return n}}class P extends N{constructor(t,e,i){super(t,3,e,i)}toJSON(){const t=super.toJSON();return delete t.nbSides,t}static from(t){return new P(t.position,t.radius,t.options)}}class C extends N{constructor(t,e,i=5,s=.5,n){super(t,i,e,n);const o=this.radius*s;N.getRotatingPoints(i,o,.5/i).forEach((t,e)=>this.points.splice(2*e+1,0,t)),this.bevelRatio=s}toJSON(){const t=Object.assign(super.toJSON(),{nbBranches:this.points.length/2,bevelRatio:this.bevelRatio});return delete t.nbSides,t}static from(t){return new C(t.position,t.radius,t.nbBranches,t.bevelRatio,t.options)}}class J extends O{constructor(t,e=0,i=0,s){super(t,s),this.width=e,this.height=i}trace(t){const e=this.getOriginPosition();return t.rect(-e.x,-e.y,this.width,this.height),this}getOriginPosition(){try{return u.from(this.options.origin)}catch(t){const{origin:e}=this.options,i=new u;return e===J.origins.center?i.set(this.width/2,this.height/2):(e!==J.origins.topRight&&e!==J.origins.bottomRight||(i.x=this.width),e!==J.origins.bottomLeft&&e!==J.origins.bottomRight||(i.y=this.height)),i}}toJSON(){return Object.assign(super.toJSON(),{width:this.width,height:this.height})}static from(t){return new J(t.position,t.width,t.height,t.options)}static get defaultOptions(){return Object.assign({origin:J.origins.topLeft},super.defaultOptions)}static get origins(){return{topLeft:"topLeft",topRight:"topRight",center:"center",bottomLeft:"bottomLeft",bottomRight:"bottomRight"}}}class j extends J{constructor(t,e,i){super(t,e,e,i)}set size(t){this.width=t,this.height=t}get size(){return this.width}toJSON(){const t=Object.assign(super.toJSON(),{size:this.size});return delete t.height,delete t.width,t}static from(t){return new j(t.position,t.size,t.options)}}class I extends J{constructor(t,e,i=null,s=null,n){super(t,i,s,n),this.file=null,this.isLoaded=!1,this.ratio=0,this._url=null,this.url=e}set url(t){this.file=null,this.isLoaded=!1,t&&(this._url=t,I.load(t).then(t=>{this.file=t,this.isLoaded=!0,this.ratio=t.width/t.height,null===this.width&&null===this.height?this.restoreSize():null===this.width?this.width=this.height*this.ratio:null===this.height&&(this.height=this.width/this.ratio),this.fire(new f(this,"load"))}).catch(()=>{this.fire(new f(this,"error"))}))}get url(){return this._url}makePath(t){if(this.isLoaded){super.makePath(t);const e=this.getOriginPosition();t.drawImage(this.file,-e.x,-e.y,this.width,this.height)}return this}restoreSize(){this.isLoaded&&(this.width=this.file.width,this.height=this.file.height)}toJSON(){return Object.assign(super.toJSON(),{url:this.url})}static from(t){return new I(t.position,t.url,t.width,t.height,t.options)}static load(t){return Array.isArray(t)?Promise.all(t.map(t=>I.load(t))):new Promise((e,i)=>{const s=window.document.createElement("img");s.crossOrigin="Anonymous",s.src=t,s.addEventListener("load",()=>e(s)),s.addEventListener("error",()=>i(new URIError(`Fail to load ${t}.`)))})}static get defaultOptions(){return Object.assign(super.defaultOptions,{fill:null})}}var M=function(t){return document.defaultView.getComputedStyle(t||document.body).direction};class H extends O{constructor(t,e="",i){super(t,i),this.lines=[],this.text=e,this._cachedMeasures={};const s=new f(this,"ready");/^(\w+:)?\/\//.test(this.options.font)?H.load(this.options.font).then(t=>{this.options.font=t,this.fire(s)}):this.fire(s)}get text(){return this.lines.join("\n")}set text(t){this.lines=Array.isArray(t)?t.reduce((t,e)=>t.concat(e.split("\n")),[]):t.split("\n")}makePath(t){if(this.text.trim().length){const e=this.height/this.lines.length,i=this.options;t.font=this.getFontDefinition(),t.textAlign=i.align,t.textBaseline="top",i.fill&&(t.fillStyle=i.fill),i.stroke&&(t.strokeStyle=i.stroke,t.lineWidth=i.strokeWidth),this.lines.forEach((s,n)=>{const o=n*e;i.fill&&t.fillText(s,0,o),i.stroke&&t.strokeText(s,0,o)})}return this}getFontDefinition(){const t=this.options;return`${t.bold?"bold ":""}${t.italic?"italic ":""}${t.fontSize}px ${t.font}`}isHover(t){if(!this.options.shown)return!1;const{width:e,height:i}=this.getMeasures(),s=this.getOriginPosition().add(u.from(t));return this.position.x<=s.x&&s.x<=this.position.x+e&&this.position.y<=s.y&&s.y<=this.position.y+i}getOriginPosition(){const{align:t}=this.options;let e=0;if(t===H.alignments.center)e=this.width/2;else if(t===H.alignments.right)e=this.width;else if(t===H.alignments.start||t===H.alignments.end){const i=this.getRoot();if(i.isScene){const s=M(i.ctx.canvas);(t===H.alignments.start&&"rtl"===s||t===H.alignments.end&&"ltr"===s)&&(e=this.width)}}return new u(e,0)}get hash(){return window.btoa(encodeURIComponent([this.text,this.options.font,this.options.fontSize,+this.options.bold,+this.options.italic].join(";")))}set hash(t){const e=decodeURIComponent(window.atob(t)).split(";");[this.text,this.options.font]=e,this.options.fontSize=+e[2],this.options.bold=Boolean(e[3]),this.options.italic=Boolean(e[4])}getMeasures(){const t=this.hash;if(this._cachedMeasures[t])return this._cachedMeasures[t];const e=this.getRoot();if(e.isScene){e.ctx.font=this.getFontDefinition();const i={width:Math.max(...this.lines.map(t=>e.ctx.measureText(t).width)),height:e.ctx.measureText("M").width*this.lines.length*1.5};return this._cachedMeasures={[t]:i},i}return{width:0,height:0}}get width(){return this.getMeasures().width}get height(){return this.getMeasures().height}toJSON(){return Object.assign(super.toJSON(),{text:this.text})}static from(t){return new H(t.position,t.text,t.options)}static load(t){if(Array.isArray(t))return Promise.all(t.map(t=>H.load(t)));const e=t.replace(/\W/g,"-"),i=new FontFace(e,`url(${t})`);return window.document.fonts.add(i),i.load().then(()=>e)}static get defaultOptions(){return Object.assign(super.defaultOptions,{font:"sans-serif",fontSize:20,align:H.alignments.start,bold:!1,italic:!1})}static get alignments(){return{left:"left",right:"right",center:"center",start:"start",end:"end"}}}class L{constructor(t,e){this.action=t,this.target=u.from(e)}execute(t,e){return this.action.call(this,t,this.target,e),this.target}toJSON(){throw new ReferenceError("Unimplemented toJSON function in Instruction")}static from(){throw new ReferenceError("Unimplemented from function in Instruction")}}class D extends O{constructor(t,e,i=!0,s){super(t,s),i||(this.options=Object.assign(k.defaultOptions,s)),this.instructions=e,this.isClosed=i,this.closing=D.lineTo(new u)}trace(t){let e=new u,i=this.instructions.slice();if(Array.isArray(i)){if(this.isClosed){const s=this.instructions[this.instructions.length-1].target;t.moveTo(s.x,s.y),i.unshift(this.closing),i.push(this.closing),e=s}else t.moveTo(0,0);i.forEach(i=>e=i.execute(t,e))}else if("string"==typeof i){this.isClosed&&(i+=" Z");const e=new Path2D(i);t.addPath(e)}return this}isHover(t,e){return this.isClosed&&super.isHover(t,e)}toJSON(){return Object.assign(super.toJSON(),{instructions:this.instructions.map(t=>t.toJSON()),isClosed:this.isClosed})}static from(t){return new D(t.position,t.instructions.map(t=>L.from(t)),t.isClosed,t.options)}static lineTo(t){return new L((t,e)=>t.lineTo(e.x,e.y),t)}static moveTo(t){return new L((t,e)=>t.moveTo(e.x,e.y),t)}static quarterTo(t,e){return D.arcTo(t,.25,4/3*(Math.sqrt(2)-1),e)}static halfTo(t,e){return D.arcTo(t,.5,4/3,e)}static arcTo(t,e,i,s=!0){return new L((t,n,o)=>{const r=o.distance(n),h=r/2,a=e/2*(s?1:-1),c=n.clone().subtract(o).rotate(-a).divide(r).multiply(i*h).add(o),l=o.clone().subtract(n).rotate(a).divide(r).multiply(i*h).add(n);t.bezierCurveTo(c.x,c.y,l.x,l.y,n.x,n.y)},t)}static quadTo(t,e){const i=u.from(e);return new L((t,e)=>{t.quadraticCurveTo(i.x,i.y,e.x,e.y)},t)}static bezierTo(t,e,i){const s=u.from(e),n=u.from(i);return new L((t,e)=>{t.bezierCurveTo(s.x,s.y,n.x,n.y,e.x,e.y)},t)}static splineThrough(t,e){const i=t.map(t=>u.from(t)),s=i[i.length-1];return new L((t,n,o)=>{const r=u.from(s).clone().subtract(n),h=i.map(t=>t.clone().subtract(r));E.splineThrough(t,[o].concat(h),e)},s)}static waveTo(t,e){throw new ReferenceError("This function has yet to be implemented.")}static sinTo(t,e,i){throw new ReferenceError("This function has yet to be implemented.")}}class _ extends y{constructor(t,e){super(t,e),this.background=new J([0,0],0,0,{fill:this.options.background,stroke:this.options.border,strokeWidth:2,cursor:O.cursors.pointer}),this.add(this.background),this.background.on(w.events.hover,()=>{this.background.options.fill=this.options.hover}).on(w.events.leave,()=>{this.background.options.fill=this.options.background}).on(w.events.click,t=>{this.click(t.position.clone().subtract(this.position))}),this.on(y.events.attach,()=>this.value=this.options.value,!0)}get value(){throw new ReferenceError(`Unimplemented get value function in ${this.constructor.name}`)}set value(t){throw new ReferenceError(`Unimplemented set value function in ${this.constructor.name}`)}click(){this.fire(new f(this,"change"))}isHover(t,e){return this.options.shown&&this.background.isHover(this.position.clone().add(t),e)}toJSON(){const t=super.toJSON();return t.options=t.options||{},t.options.value=this.value,t.children=t.children.slice(1),t}static from(t){return new this(t.position,t.options)}static get defaultOptions(){return Object.assign(super.defaultOptions,{value:null,fill:"#444",background:"#f6f6f6",border:"#aaa",hover:"#dcdcdc"})}static get events(){return{change:"change"}}}class G extends _{constructor(t,e){super(t,e),this.text=new H(void 0,this.options.value,{fill:this.options.fill,cursor:this.background.options.cursor,font:this.options.font,fontSize:this.options.fontSize,bold:this.options.bold,italic:this.options.italic}),this.background.add(this.text)}click(){}get value(){return this.text.text}set value(t){this.text.text=t;const e=this.text.getMeasures(),i=e.height*G.MARGIN;this.background.width=e.width+4*i,this.background.height=e.height+i,this.text.position.set(2*i,i)}static get defaultOptions(){const t=H.defaultOptions;return Object.assign(super.defaultOptions,{font:t.font,fontSize:t.fontSize,bold:t.bold,italic:t.italic,value:""})}static get MARGIN(){return.2}}class $ extends _{constructor(t,e){super(t,e),this.background.width=this.options.size,this.background.height=this.options.size;const i=this.options.size*$.MARGIN;this.fill=new j([i,i],this.options.size-2*i,{fill:this.options.fill,shown:this.options.value,cursor:this.background.options.cursor}),this.background.add(this.fill)}click(){this.toggle(),super.click()}toggle(t=!this.value){return this.value=t,t}get value(){return this.fill.options.shown}set value(t){t?this.fill.show():this.fill.hide()}static get defaultOptions(){return Object.assign(super.defaultOptions,{size:20,value:!1})}static get MARGIN(){return.2}}O.prototype.draggable=function(t){const e=this.options.cursor===O.cursors.default;e&&(this.options.cursor=O.cursors.grab),this.isDraggable=!0;const i=Object.assign({x:!0,y:!0},t);let s=null,n=null;return this.on(w.events.down,t=>{e&&(this.options.cursor=O.cursors.grabbing),s=t.position,n=this.position.clone(),this.isDragged=!0,this.fire(new w(this,w.events.grab,t.position))},!0),this.getScene().then(t=>t.on(w.events.move,t=>{if(this.isDragged&&s){const e=t.position.clone().subtract(s),o=n.clone().add(i.x&&e.x,i.y&&e.y);this.position.set(o),i.constrain&&this.position.constrain(i.constrain.start,i.constrain.end),this.fire(new w(this,w.events.drag,t.position))}}).on(w.events.up,t=>{e&&(this.options.cursor=O.cursors.grab),this.isDragged=!1,s=null,this.fire(new w(this,w.events.drop,t.position))})),{set x(t){i.x=t},set y(t){i.y=t},set constrain(t){i.constrain=t}}};class F extends _{constructor(t,e){super(t,e),this.background.width=this.width,this.background.height=F.HEIGHT;const i=new y(new u(F.HEIGHT/2,F.HEIGHT/2));this.background.add(i),this.handle=new T(new u(0,0),(F.HEIGHT-2)/2,{fill:this.options.fill,cursor:O.cursors.ewResize}),i.add(this.handle),this.constrainer=new p(new u(0,0),new u(this.width-F.HEIGHT,0)),this.handle.draggable({constrain:this.constrainer}),this.handle.on(w.events.drag,()=>this.fire(new f(this,"change")),!0)}click(t){this.handle.position.set(t.x-F.HEIGHT/2,0).constrain(this.constrainer.start,this.constrainer.end),super.click()}_moveHandle(t){const e=this.options.max-this.options.min;this.handle.position.x=(this.width-F.HEIGHT)*((t-this.options.min)/e)}set width(t){if(t<F.HEIGHT)throw new RangeError(`Slider is too small, minimum is ${F.HEIGHT}`);this.options.width=t,this.background.width=t,this.constrainer.end=new u(this.width-F.HEIGHT,0),this._moveHandle(this.value)}get width(){return this.options.width}get value(){const t=this.options.max-this.options.min,e=this.handle.position.x/(this.width-F.HEIGHT);return this.options.min+t*e}set value(t){const e=n(t,this.options.min,this.options.max);return this._moveHandle(e),e}static get defaultOptions(){return Object.assign(super.defaultOptions,{min:0,max:10,width:200})}static get HEIGHT(){return 20}}J.prototype.resizable=function(t){this.isResizable=!0;const e=Object.assign({x:!0,y:!0},t);if((!e.x||!e.y)&&this instanceof j)throw new TypeError("Square should be resizable in both x and y axis.");const i=new A([this.width,this.height],[[0,0],[-15,0],[0,-15]],{fill:"gold",cursor:O.cursors.seResize});this.add(i);const s=i.draggable({x:e.x,y:e.y,constrain:e.constrain});return i.on(w.events.drag,t=>{const s=this.width,n=this.height;this instanceof j?(this.size=(i.position.x+i.position.y)/2+15,i.position.x=this.size,i.position.y=this.size):(e.x&&(this.width=i.position.x),e.y&&(this.height=i.position.y)),this.width===s&&this.height===n||this.fire(new w(this,w.events.resize,t))},!0),s};var U=i(0);const q={Container:y,Scene:S,Arc:z,Ellipse:R,Circle:T,Line:k,Spline:E,Polygon:A,RegularPolygon:N,Triangle:P,Star:C,Rectangle:J,Square:j,Image:I,Text:H,Path:D,Position:u,Vector:p,Slider:F,Checkbox:$,Button:G};Object.assign({EventEmitter:v,Component:O,Input:_,BaseEvent:f,MouseEvent:w,KeyboardEvent:m,default:void 0,from:function t(e){const i=q[e.constructor].from(e);return e.children&&i.add(...e.children.map(e=>t(e))),i},Math:s,OffScreenCanvas:g,version:U.c,author:U.a,homepage:U.b},q);class B extends E{constructor(t,e){super(t.position,[],.2,{stroke:"#333",zIndex:-10}),this.from=t,this.to=e,this.middle=this.getCenter()}getCenter(){return this.position.clone().lerp(this.to.position,.5)}trace(...t){const e=this.getCenter();this.middle.lerp(e,.1),this.points=[this.middle,this.to.position].map(t=>t.clone().subtract(this.position)),this.children.forEach(t=>{t.position.lerp(t.options.destination,.08),t.position.distance(t.options.destination)<t.radius&&t.remove()}),super.trace(...t)}getOther(t){return t===this.from?this.to:t===this.to?this.from:null}sendFrom(t){const e=this.getOther(t);e.value+=1;const i=new T(t.position.clone().subtract(this.position),10,{fill:"#99ff66",stroke:"#333",zIndex:-5,destination:e.position.clone().subtract(this.position)});this.add(i)}}const W="#333";class Y extends T{constructor(t,e,i=0){super(t,e,{stroke:W});const s=e/2,n=new T([0,4-s],s,{fill:"#fff",stroke:W,cursor:"pointer"});this.text=new H([0,-s/2],"0",{align:H.alignments.center,fill:W,fontSize:s,cursor:"pointer"}),n.add(this.text),this.add(n),this.links=[],this._value=null,this.value=i,this.on("click",()=>this.click()),this.draggable()}click(){this.value-=this.links.length,this.links.forEach(t=>t.sendFrom(this)),this.fire(new f(this,"lends"))}remove(){this.links.forEach(t=>t.remove()),super.remove()}get value(){return this._value}set value(t){this._value=Math.round(t),this.text.text=this._value.toString(),this._value<0?this.options.fill="#ff7365":this.options.fill="#99ff66"}linkTo(t){if(t&&!this.links.find(e=>e.getOther(this)===t)){const e=new B(this,t);return this.links.push(e),t.links.push(e),e}return null}toJSON(){return{position:this.position.toJSON(),links:[],value:this.value}}}function V(t,e=[],i=0){return{position:u.from(t),links:e,value:i}}const X=localStorage,K="socsim",Z=btoa,Q=atob;const tt=t=>{const e=Z(function(t){return Math.random().toString(36).slice(-t)}(7)+Z(JSON.stringify(t)));X.setItem(K,e)};class et{constructor(){this.nodes=[]}isWon(){return!this.nodes.find(t=>t.value<0)}get(t){return this.nodes[t]}add(t){this.nodes.push(t)}magnetic(){const t=3*this.nodes[0].radius;this.nodes.forEach(e=>{if(!e.isDragged){const i=this.nodes.reduce((i,s)=>{const n=e.position.distance(s.position);return s!==e&&n<t&&i.add(e.position.clone().subtract(s.position).multiply((t-n)**2)),i},new u(0,0));e.position.add(i.divide(3e5))}})}toJSON(){const t=this.nodes.map(t=>t.toJSON());return this.nodes.forEach((e,i)=>t[i].links=e.links.map(t=>this.nodes.indexOf(t.getOther(e)))),t}static getNoduleRadius(t,e){return Math.min(...e)/(t**.5*2)}}function it(t){return new u(s.random(-t[0],t[0]),s.random(-t[1],t[1]))}const st=document.getElementById("scene"),nt=new S(st,{fill:"#f5f5f5"}),ot=.1*Math.min(nt.width,nt.height),rt=[nt.width/2-ot,nt.height/2-ot],ht=Math.floor(nt.width*nt.height/12e4),at=(()=>{const t=X.getItem(K);if(!t)return{};const e=Q(Q(t).slice(7));return JSON.parse(e)})();let ct,lt=at.mv||0,ut=at.cl||0,dt=at.df||0;const pt=new y(nt.center);function gt(t){pt.empty(),ct=t?function(t,e){const i=et.getNoduleRadius(t.length,e),s=new et;for(let e=0,n=t.length;e<n;++e){const n=t[e],o=new Y(n.position,i,n.value);n.links.filter(t=>t<e).map(t=>o.linkTo(s.nodes[t])),s.add(o)}return s}(t,rt):function(t,e,i){const n=et.getNoduleRadius(e,t),o=new et;let r=0;for(let i=0;i<e;++i){let e;do{e=it(t)}while(o.nodes.find(t=>t.position.distance(e)<2*n));const i=new Y(e,n);o.nodes.map((t,e)=>e).filter(t=>o.get(t).links.length<3).sort((t,i)=>o.get(t).position.distance(e)-o.get(i).position.distance(e)).slice(0,Math.round(s.random(1)+1)).forEach(t=>i.linkTo(o.get(t))),r+=i.links.length,o.add(i)}const h=Math.ceil(e**.5);let a=0;o.nodes.slice(1).forEach(t=>{const e=Math.round(s.random(2*h)-h);t.value=e,a+=e});const c=r-e+1,l=e/2*i;return o.get(0).value=c-a+l,o}(rt,Math.floor(ht+dt),1-dt%1);for(let t=0,e=ct.nodes.length;t<e;++t){const e=ct.get(t);pt.add(...e.links,e)}}nt.add(pt);const ft=[[V([-100,0],[1],1),V([100,0],[0],-1)],[V([-300,0],[1],2),V([0,0],[0,2],-4),V([300,0],[1],2)],(()=>{let t=0;const e=N.getRotatingPoints(3,200);return[V(e[t++],[1,2],3),V(e[t++],[0,2],-2),V(e[t],[0,1],1)]})(),(()=>{const t=N.getRotatingPoints(5,200);return[V([0,0],[],30),...t.map(t=>V(t,[0],-5))]})(),(()=>{let t=0;const e=N.getRotatingPoints(8,200);return[V(e[t++],[],5),V(e[t++],[t-2],1),V(e[t++],[t-2],1),V(e[t++],[t-2],1),V(e[t++],[t-2],-2),V(e[t++],[t-2],1),V(e[t++],[t-2],1),V(e[t++],[t-2,0],1)]})()];gt(at.gr||ft[ut]);const wt=new J([0,0],nt.width,nt.height,{fill:"#111",opacity:.5,zIndex:10}),mt=new H(nt.center.subtract(0,70),"",{fill:"red",fontSize:70,align:"center",opacity:1,rotationAnchor:[0,35]});wt.add(mt);const vt=new H([10,10],`Level: ${ut}`,{fill:"#666"});function bt(t){tt({cl:ut,df:dt,gr:!t&&ct,mv:!t&&lt})}nt.add(vt),wt.on("click",()=>{wt.remove(),lt=0,gt(ft[ut]),vt.text=`Level: ${ut}`,bt()}),nt.on("lends",()=>{lt++,ct.isWon()?(nt.add(wt),mt.text=`You won in ${lt} moves !`,ft[ut]||(dt+=.6),ut++,bt(!0)):bt()}).on("draw",()=>{wt.options.shown&&(mt.options.rotation=Math.cos(mt.frameCount/20)/50),ct.magnetic()},!0).startLoop()}]);