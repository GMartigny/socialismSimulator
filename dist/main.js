!function(t){var e={};function s(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(i,n,function(e){return t[e]}.bind(null,n));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=6)}([function(t){t.exports=JSON.parse('{"a":{"name":"Guillaume Martigny","email":"guillaume.martigny@gmail.com","url":"https://www.guillaume-martigny.fr"},"b":"https://github.com/pencil-js/pencil.js#readme","c":"1.12.0"}')},function(t,e,s){var i=s(2),n=s(5),r={};Object.keys(i).forEach((function(t){r[t]={},Object.defineProperty(r[t],"channels",{value:i[t].channels}),Object.defineProperty(r[t],"labels",{value:i[t].labels});var e=n(t);Object.keys(e).forEach((function(s){var i=e[s];r[t][s]=function(t){var e=function(e){if(null==e)return e;arguments.length>1&&(e=Array.prototype.slice.call(arguments));var s=t(e);if("object"==typeof s)for(var i=s.length,n=0;n<i;n++)s[n]=Math.round(s[n]);return s};return"conversion"in t&&(e.conversion=t.conversion),e}(i),r[t][s].raw=function(t){var e=function(e){return null==e?e:(arguments.length>1&&(e=Array.prototype.slice.call(arguments)),t(e))};return"conversion"in t&&(e.conversion=t.conversion),e}(i)}))})),t.exports=r},function(t,e,s){var i=s(4),n={};for(var r in i)i.hasOwnProperty(r)&&(n[i[r]]=r);var o=t.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(var a in o)if(o.hasOwnProperty(a)){if(!("channels"in o[a]))throw new Error("missing channels property: "+a);if(!("labels"in o[a]))throw new Error("missing channel labels property: "+a);if(o[a].labels.length!==o[a].channels)throw new Error("channel and label counts mismatch: "+a);var h=o[a].channels,l=o[a].labels;delete o[a].channels,delete o[a].labels,Object.defineProperty(o[a],"channels",{value:h}),Object.defineProperty(o[a],"labels",{value:l})}o.rgb.hsl=function(t){var e,s,i=t[0]/255,n=t[1]/255,r=t[2]/255,o=Math.min(i,n,r),a=Math.max(i,n,r),h=a-o;return a===o?e=0:i===a?e=(n-r)/h:n===a?e=2+(r-i)/h:r===a&&(e=4+(i-n)/h),(e=Math.min(60*e,360))<0&&(e+=360),s=(o+a)/2,[e,100*(a===o?0:s<=.5?h/(a+o):h/(2-a-o)),100*s]},o.rgb.hsv=function(t){var e,s,i,n,r,o=t[0]/255,a=t[1]/255,h=t[2]/255,l=Math.max(o,a,h),c=l-Math.min(o,a,h),u=function(t){return(l-t)/6/c+.5};return 0===c?n=r=0:(r=c/l,e=u(o),s=u(a),i=u(h),o===l?n=i-s:a===l?n=1/3+e-i:h===l&&(n=2/3+s-e),n<0?n+=1:n>1&&(n-=1)),[360*n,100*r,100*l]},o.rgb.hwb=function(t){var e=t[0],s=t[1],i=t[2];return[o.rgb.hsl(t)[0],100*(1/255*Math.min(e,Math.min(s,i))),100*(i=1-1/255*Math.max(e,Math.max(s,i)))]},o.rgb.cmyk=function(t){var e,s=t[0]/255,i=t[1]/255,n=t[2]/255;return[100*((1-s-(e=Math.min(1-s,1-i,1-n)))/(1-e)||0),100*((1-i-e)/(1-e)||0),100*((1-n-e)/(1-e)||0),100*e]},o.rgb.keyword=function(t){var e=n[t];if(e)return e;var s,r,o,a=1/0;for(var h in i)if(i.hasOwnProperty(h)){var l=i[h],c=(r=t,o=l,Math.pow(r[0]-o[0],2)+Math.pow(r[1]-o[1],2)+Math.pow(r[2]-o[2],2));c<a&&(a=c,s=h)}return s},o.keyword.rgb=function(t){return i[t]},o.rgb.xyz=function(t){var e=t[0]/255,s=t[1]/255,i=t[2]/255;return[100*(.4124*(e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92)+.3576*(s=s>.04045?Math.pow((s+.055)/1.055,2.4):s/12.92)+.1805*(i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92)),100*(.2126*e+.7152*s+.0722*i),100*(.0193*e+.1192*s+.9505*i)]},o.rgb.lab=function(t){var e=o.rgb.xyz(t),s=e[0],i=e[1],n=e[2];return i/=100,n/=108.883,s=(s/=95.047)>.008856?Math.pow(s,1/3):7.787*s+16/116,[116*(i=i>.008856?Math.pow(i,1/3):7.787*i+16/116)-16,500*(s-i),200*(i-(n=n>.008856?Math.pow(n,1/3):7.787*n+16/116))]},o.hsl.rgb=function(t){var e,s,i,n,r,o=t[0]/360,a=t[1]/100,h=t[2]/100;if(0===a)return[r=255*h,r,r];e=2*h-(s=h<.5?h*(1+a):h+a-h*a),n=[0,0,0];for(var l=0;l<3;l++)(i=o+1/3*-(l-1))<0&&i++,i>1&&i--,r=6*i<1?e+6*(s-e)*i:2*i<1?s:3*i<2?e+(s-e)*(2/3-i)*6:e,n[l]=255*r;return n},o.hsl.hsv=function(t){var e=t[0],s=t[1]/100,i=t[2]/100,n=s,r=Math.max(i,.01);return s*=(i*=2)<=1?i:2-i,n*=r<=1?r:2-r,[e,100*(0===i?2*n/(r+n):2*s/(i+s)),100*((i+s)/2)]},o.hsv.rgb=function(t){var e=t[0]/60,s=t[1]/100,i=t[2]/100,n=Math.floor(e)%6,r=e-Math.floor(e),o=255*i*(1-s),a=255*i*(1-s*r),h=255*i*(1-s*(1-r));switch(i*=255,n){case 0:return[i,h,o];case 1:return[a,i,o];case 2:return[o,i,h];case 3:return[o,a,i];case 4:return[h,o,i];case 5:return[i,o,a]}},o.hsv.hsl=function(t){var e,s,i,n=t[0],r=t[1]/100,o=t[2]/100,a=Math.max(o,.01);return i=(2-r)*o,s=r*a,[n,100*(s=(s/=(e=(2-r)*a)<=1?e:2-e)||0),100*(i/=2)]},o.hwb.rgb=function(t){var e,s,i,n,r,o,a,h=t[0]/360,l=t[1]/100,c=t[2]/100,u=l+c;switch(u>1&&(l/=u,c/=u),i=6*h-(e=Math.floor(6*h)),0!=(1&e)&&(i=1-i),n=l+i*((s=1-c)-l),e){default:case 6:case 0:r=s,o=n,a=l;break;case 1:r=n,o=s,a=l;break;case 2:r=l,o=s,a=n;break;case 3:r=l,o=n,a=s;break;case 4:r=n,o=l,a=s;break;case 5:r=s,o=l,a=n}return[255*r,255*o,255*a]},o.cmyk.rgb=function(t){var e=t[0]/100,s=t[1]/100,i=t[2]/100,n=t[3]/100;return[255*(1-Math.min(1,e*(1-n)+n)),255*(1-Math.min(1,s*(1-n)+n)),255*(1-Math.min(1,i*(1-n)+n))]},o.xyz.rgb=function(t){var e,s,i,n=t[0]/100,r=t[1]/100,o=t[2]/100;return s=-.9689*n+1.8758*r+.0415*o,i=.0557*n+-.204*r+1.057*o,e=(e=3.2406*n+-1.5372*r+-.4986*o)>.0031308?1.055*Math.pow(e,1/2.4)-.055:12.92*e,s=s>.0031308?1.055*Math.pow(s,1/2.4)-.055:12.92*s,i=i>.0031308?1.055*Math.pow(i,1/2.4)-.055:12.92*i,[255*(e=Math.min(Math.max(0,e),1)),255*(s=Math.min(Math.max(0,s),1)),255*(i=Math.min(Math.max(0,i),1))]},o.xyz.lab=function(t){var e=t[0],s=t[1],i=t[2];return s/=100,i/=108.883,e=(e/=95.047)>.008856?Math.pow(e,1/3):7.787*e+16/116,[116*(s=s>.008856?Math.pow(s,1/3):7.787*s+16/116)-16,500*(e-s),200*(s-(i=i>.008856?Math.pow(i,1/3):7.787*i+16/116))]},o.lab.xyz=function(t){var e,s,i,n=t[0];e=t[1]/500+(s=(n+16)/116),i=s-t[2]/200;var r=Math.pow(s,3),o=Math.pow(e,3),a=Math.pow(i,3);return s=r>.008856?r:(s-16/116)/7.787,e=o>.008856?o:(e-16/116)/7.787,i=a>.008856?a:(i-16/116)/7.787,[e*=95.047,s*=100,i*=108.883]},o.lab.lch=function(t){var e,s=t[0],i=t[1],n=t[2];return(e=360*Math.atan2(n,i)/2/Math.PI)<0&&(e+=360),[s,Math.sqrt(i*i+n*n),e]},o.lch.lab=function(t){var e,s=t[0],i=t[1];return e=t[2]/360*2*Math.PI,[s,i*Math.cos(e),i*Math.sin(e)]},o.rgb.ansi16=function(t){var e=t[0],s=t[1],i=t[2],n=1 in arguments?arguments[1]:o.rgb.hsv(t)[2];if(0===(n=Math.round(n/50)))return 30;var r=30+(Math.round(i/255)<<2|Math.round(s/255)<<1|Math.round(e/255));return 2===n&&(r+=60),r},o.hsv.ansi16=function(t){return o.rgb.ansi16(o.hsv.rgb(t),t[2])},o.rgb.ansi256=function(t){var e=t[0],s=t[1],i=t[2];return e===s&&s===i?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(s/255*5)+Math.round(i/255*5)},o.ansi16.rgb=function(t){var e=t%10;if(0===e||7===e)return t>50&&(e+=3.5),[e=e/10.5*255,e,e];var s=.5*(1+~~(t>50));return[(1&e)*s*255,(e>>1&1)*s*255,(e>>2&1)*s*255]},o.ansi256.rgb=function(t){if(t>=232){var e=10*(t-232)+8;return[e,e,e]}var s;return t-=16,[Math.floor(t/36)/5*255,Math.floor((s=t%36)/6)/5*255,s%6/5*255]},o.rgb.hex=function(t){var e=(((255&Math.round(t[0]))<<16)+((255&Math.round(t[1]))<<8)+(255&Math.round(t[2]))).toString(16).toUpperCase();return"000000".substring(e.length)+e},o.hex.rgb=function(t){var e=t.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!e)return[0,0,0];var s=e[0];3===e[0].length&&(s=s.split("").map((function(t){return t+t})).join(""));var i=parseInt(s,16);return[i>>16&255,i>>8&255,255&i]},o.rgb.hcg=function(t){var e,s=t[0]/255,i=t[1]/255,n=t[2]/255,r=Math.max(Math.max(s,i),n),o=Math.min(Math.min(s,i),n),a=r-o;return e=a<=0?0:r===s?(i-n)/a%6:r===i?2+(n-s)/a:4+(s-i)/a+4,e/=6,[360*(e%=1),100*a,100*(a<1?o/(1-a):0)]},o.hsl.hcg=function(t){var e=t[1]/100,s=t[2]/100,i=1,n=0;return(i=s<.5?2*e*s:2*e*(1-s))<1&&(n=(s-.5*i)/(1-i)),[t[0],100*i,100*n]},o.hsv.hcg=function(t){var e=t[1]/100,s=t[2]/100,i=e*s,n=0;return i<1&&(n=(s-i)/(1-i)),[t[0],100*i,100*n]},o.hcg.rgb=function(t){var e=t[0]/360,s=t[1]/100,i=t[2]/100;if(0===s)return[255*i,255*i,255*i];var n,r=[0,0,0],o=e%1*6,a=o%1,h=1-a;switch(Math.floor(o)){case 0:r[0]=1,r[1]=a,r[2]=0;break;case 1:r[0]=h,r[1]=1,r[2]=0;break;case 2:r[0]=0,r[1]=1,r[2]=a;break;case 3:r[0]=0,r[1]=h,r[2]=1;break;case 4:r[0]=a,r[1]=0,r[2]=1;break;default:r[0]=1,r[1]=0,r[2]=h}return n=(1-s)*i,[255*(s*r[0]+n),255*(s*r[1]+n),255*(s*r[2]+n)]},o.hcg.hsv=function(t){var e=t[1]/100,s=e+t[2]/100*(1-e),i=0;return s>0&&(i=e/s),[t[0],100*i,100*s]},o.hcg.hsl=function(t){var e=t[1]/100,s=t[2]/100*(1-e)+.5*e,i=0;return s>0&&s<.5?i=e/(2*s):s>=.5&&s<1&&(i=e/(2*(1-s))),[t[0],100*i,100*s]},o.hcg.hwb=function(t){var e=t[1]/100,s=e+t[2]/100*(1-e);return[t[0],100*(s-e),100*(1-s)]},o.hwb.hcg=function(t){var e=t[1]/100,s=1-t[2]/100,i=s-e,n=0;return i<1&&(n=(s-i)/(1-i)),[t[0],100*i,100*n]},o.apple.rgb=function(t){return[t[0]/65535*255,t[1]/65535*255,t[2]/65535*255]},o.rgb.apple=function(t){return[t[0]/255*65535,t[1]/255*65535,t[2]/255*65535]},o.gray.rgb=function(t){return[t[0]/100*255,t[0]/100*255,t[0]/100*255]},o.gray.hsl=o.gray.hsv=function(t){return[0,0,t[0]]},o.gray.hwb=function(t){return[0,100,t[0]]},o.gray.cmyk=function(t){return[0,0,0,t[0]]},o.gray.lab=function(t){return[t[0],0,0]},o.gray.hex=function(t){var e=255&Math.round(t[0]/100*255),s=((e<<16)+(e<<8)+e).toString(16).toUpperCase();return"000000".substring(s.length)+s},o.rgb.gray=function(t){return[(t[0]+t[1]+t[2])/3/255*100]}},function(t,e,s){"use strict";const i=t=>{let e=2166136261;for(let s=0;s<t.length;s++)e^=t.charCodeAt(s),e+=(e<<1)+(e<<4)+(e<<7)+(e<<8)+(e<<24);return e>>>0};t.exports=i,t.exports.default=i},function(t,e,s){"use strict";t.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},function(t,e,s){var i=s(2);function n(t){var e=function(){for(var t={},e=Object.keys(i),s=e.length,n=0;n<s;n++)t[e[n]]={distance:-1,parent:null};return t}(),s=[t];for(e[t].distance=0;s.length;)for(var n=s.pop(),r=Object.keys(i[n]),o=r.length,a=0;a<o;a++){var h=r[a],l=e[h];-1===l.distance&&(l.distance=e[n].distance+1,l.parent=n,s.unshift(h))}return e}function r(t,e){return function(s){return e(t(s))}}function o(t,e){for(var s=[e[t].parent,t],n=i[e[t].parent][t],o=e[t].parent;e[o].parent;)s.unshift(e[o].parent),n=r(i[e[o].parent][o],n),o=e[o].parent;return n.conversion=s,n}t.exports=function(t){for(var e=n(t),s={},i=Object.keys(e),r=i.length,a=0;a<r;a++){var h=i[a];null!==e[h].parent&&(s[h]=o(h,e))}return s}},function(t,e,s){"use strict";s.r(e);var i={};s.r(i),s.d(i,"constrain",(function(){return a})),s.d(i,"equals",(function(){return h})),s.d(i,"random",(function(){return l})),s.d(i,"truncate",(function(){return c})),s.d(i,"radianCircle",(function(){return u})),s.d(i,"degreeCircle",(function(){return d})),s.d(i,"phi",(function(){return p})),s.d(i,"modulo",(function(){return g})),s.d(i,"distribute",(function(){return f})),s.d(i,"sum",(function(){return w})),s.d(i,"average",(function(){return m})),s.d(i,"map",(function(){return b})),s.d(i,"lerp",(function(){return v}));var n={};s.r(n),s.d(n,"prepareScenes",(function(){return lt})),s.d(n,"displayScene",(function(){return ht})),s.d(n,"getCurrentScene",(function(){return at}));class r{constructor(){this.eventListeners={}}on(t,e,s=!1){const i={callback:e,element:this,isTargeted:s};return(Array.isArray(t)?t:[t]).forEach(t=>{this.eventListeners[t]||(this.eventListeners[t]=[]),this.eventListeners[t].push(i)}),this}fire(t){const e=this.eventListeners[t.name];return e&&e.forEach(e=>{e.isTargeted&&e.element!==t.target||e.callback.call(this,t)}),this}removeListener(t){return(Array.isArray(t)?t:[t]).forEach(t=>delete this.eventListeners[t]),this}removeAllListener(){return this.eventListeners={},this}static get events(){return{}}}class o{constructor(t,e){this.name=t,this.target=e}}const a=(t,e,s)=>Math.min(Math.max(t,e),s),h=(t,e,s=Number.EPSILON)=>Math.abs(t-e)<s,l=(t=1,e)=>{let s=t,i=e;return void 0===e&&(s=0,i=t),Math.random()*(i-s)+s},c=t=>t<<0,u=2*Math.PI,d=360,p=(Math.sqrt(5)+1)/2,g=(t,e)=>{const s=t%e;return Math.sign(t)===Math.sign(e)?s:s+e},f=(t,e=0,s=1)=>{const i=l(e,s),n=s-e;return[...new Array(t)].map((t,s)=>e+g(i+s*p*n,n))},w=(...t)=>t.reduce((t,e)=>t+e,0),m=(...t)=>w(...t)/t.length,b=(t,e,s,i=0,n=1)=>(t-e)/(s-e)*(n-i)+i,v=(t,e,s)=>t+(e-t)*s;class y{constructor(t=0,e=0){this.x=+t,this.y=+e}set(t,e){let s=0,i=0;if("number"==typeof t)s=t,i=void 0===e?t:e;else{const e=y.from(t);({x:s,y:i}=e)}return this.x=s,this.y=i,this}clone(){return new y(this.x,this.y)}equals(t){const e=y.from(t);return h(this.x,e.x)&&h(this.y,e.y)}calc(t,e,s){let i=0,n=0;if("number"==typeof e)i=t(this.x,e),n=t(this.y,void 0===s?e:s);else{const s=y.from(e);i=t(this.x,s.x),n=t(this.y,s.y)}return this.set(i,n)}add(t,e){return this.calc((t,e)=>t+e,t,e)}subtract(t,e){return this.calc((t,e)=>t-e,t,e)}multiply(t,e){return this.calc((t,e)=>t*e,t,e)}divide(t,e){return this.calc((t,e)=>t/e,t,e)}modulo(t,e){return this.calc((t,e)=>g(t,e),t,e)}power(t,e){return this.calc((t,e)=>t**e,t,e)}rotate(t=0,e){const{cos:s,sin:i}=Math,n=t*u,r=y.from(e),o=this.clone().subtract(r),a=o.x*s(n)-o.y*i(n),h=o.y*s(n)+o.x*i(n);return this.set(a,h).add(r)}constrain(t,e){const s=y.from(t),i=y.from(e),n=a(this.x,Math.min(s.x,i.x),Math.max(s.x,i.x)),r=a(this.y,Math.min(s.y,i.y),Math.max(s.y,i.y));return this.set(n,r)}lerp(t,e){const s=y.from(t).clone().subtract(this).multiply(e);return this.add(s)}distance(t){const e=y.from(t);return Math.hypot(e.x-this.x,e.y-this.y)}dotProduct(t){const e=y.from(t);return this.x*e.x+this.y*e.y}crossProduct(t){const e=y.from(t);return this.x*e.y-this.y*e.x}isOnSameSide(t,e){const s=y.from(t),i=this.clone().subtract(e.start),n=s.clone().subtract(e.start),r=e.getDelta(),{sign:o}=Math;return o(i.crossProduct(r))===o(n.crossProduct(r))}get angle(){return Math.atan(this.y/this.x)/u+(this.x<0?.75:.25)}toJSON(){const{x:t,y:e}=this;return[c(t),c(e)]}static from(t=new y){if(t instanceof y)return t;if(Array.isArray(t))return new y(...t);if("Object"===t.constructor.name)return new y(t.x,t.y);throw new TypeError(`Unexpected type for position: ${JSON.stringify(t)}.`)}static average(...t){let e=new y;t.forEach(t=>e=e.add(y.from(t)));const s=t.length;return e.divide(s)}}const x=Symbol("_scenePromise");class k extends r{constructor(t=new y,e){super(),this.position=y.from(t),this.options=this.constructor.defaultOptions,this.setOptions(e),this.children=[],this.parent=null,this.frameCount=0,this[x]=new Promise(t=>{this.on(k.events.attach,()=>{const e=this.getRoot();e.isScene?t(e):e.getScene().then(e=>t(e))})})}setOptions(t){return this.options={...this.options,...t},this.options.rotationCenter=y.from(this.options.rotationCenter),this.options.scale=y.from(this.options.scale),this}isHover(){return!1}add(...t){return t.forEach(t=>{if(t===this)throw new RangeError("A container can't contain itself.");if(t.isScene)throw new RangeError("A scene can't be contained in another container.");t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.fire(new o(k.events.attach,t))}),this}remove(...t){return t.forEach(t=>{if(this.children.includes(t)){const e=this.children.splice(this.children.indexOf(t),1)[0];e.parent=null,e.fire(new o(k.events.detach,e))}}),this}empty(){return this.remove(...this.children)}delete(){return this.parent&&this.parent.remove(this),this}getScene(){return this[x]}getRoot(){return this.parent?this.parent.getRoot():this}getAbsolutePosition(){const t=new y;return this.climbAncestry(e=>{t.rotate(e.options.rotation,e.options.rotationCenter).add(e.position)}),t}fire(t){return super.fire(t),this.parent&&this.parent.fire(t),this}getTarget(t,e){if(!this.options.shown)return null;const s=t.clone().subtract(this.position).rotate(-this.options.rotation,this.options.rotationCenter);let i=null,n=this.children.length-1;for(;!i&&n>=0;)i=this.children[n].getTarget(s,e),--n;return i?i.options.zIndex<0&&this===i.parent&&this.isHover(t,e)&&this||i:this.isHover(t,e)&&this||null}render(t){if(!this.options.shown)return this;if(this.frameCount++,this.fire(new o(k.events.draw,this)),t.save(),t.translate(this.position.x,this.position.y),this.options.clip){const e=new window.Path2D,s=this.options.clip===k.ITSELF?this:this.options.clip,{x:i,y:n}=s.position;t.translate(i,n),s.trace&&s.trace(e),t.clip(e),t.translate(-i,-n)}if(this.options.rotation){const e=y.from(this.options.rotationCenter);t.translate(e.x,e.y),t.rotate(this.options.rotation*u),t.translate(-e.x,-e.y)}const e=y.from(this.options.scale);t.scale(e.x,e.y),this.children.sort((t,e)=>t.options.zIndex-e.options.zIndex),k.setOpacity(t,this.options.opacity);const s=this.children.findIndex(t=>t.options.zIndex>=0),i=-1===s?this.children.length:s;for(let e=0,s=i;e<s;++e)this.children[e].render(t);this.makePath(t);for(let e=i,s=this.children.length;e<s;++e)this.children[e].render(t);return t.restore(),this}makePath(){return this}show(){return this.options.shown=!0,this.fire(new o(k.events.show,this)),this}hide(){return this.options.shown=!1,this.fire(new o(k.events.hide,this)),this}isAncestorOf(t){return!(!t||!t.parent)&&(t.parent===this||this.isAncestorOf(t.parent))}climbAncestry(t,e){t(this),this.parent&&this.parent!==e&&this.parent.climbAncestry(t)}toJSON(){const{defaultOptions:t}=this.constructor,e={};Object.keys(this.options).forEach(s=>{const i=this.options[s];(i&&i.equals?i.equals(t[s]):Object.is(i,t[s]))||(e[s]=i)});const s={constructor:this.constructor.name,position:this.position};return this.children.length&&(s.children=this.children.map(t=>t.toJSON())),Object.keys(e).length&&(s.options=e),s}clone(){return this.constructor.from(this.toJSON())}static setOpacity(t,e){null!==e&&t.globalAlpha!==e&&(t.globalAlpha=e)}static from(t){return new k(t.position,t.options)}static get defaultOptions(){return{shown:!0,opacity:null,rotation:0,scale:new y(1,1),rotationCenter:new y,zIndex:1,clip:null}}static get events(){return{...super.events,attach:"attach",detach:"detach",draw:"draw",hide:"hide",show:"show"}}static get ITSELF(){return"itself"}}function O(t){let e;try{e=S.from(t).getDelta()}catch(s){e=t.getDelta?t.getDelta():t}return e}class S{constructor(t,e){this.start=y.from(t),this.end=y.from(e)}get width(){return Math.abs(this.start.x-this.end.x)}get height(){return Math.abs(this.start.y-this.end.y)}get length(){return this.start.distance(this.end)}clone(){return new S(this.start.clone(),this.end.clone())}equals(t){const e=S.from(t);return this.start.equals(e.start)&&this.end.equals(e.end)}getDelta(){return this.end.clone().subtract(this.start)}add(t){const e=O(t);return this.end.add(e),this}translate(t){const e=O(t);return this.start.add(e),this.end.add(e),this}multiply(t){if("number"==typeof t)return this.add(this.getDelta().multiply(t-1)),this;const e=O(t);return this.end.multiply(e),this}intersect(t){const e=S.from(t);return!(this.start.isOnSameSide(this.end,e)||e.start.isOnSameSide(e.end,this))}getClosestToPoint(t){const e=y.from(t),s=new S(this.start,e).getDelta(),i=this.getDelta(),n=s.dotProduct(i)/this.length**2;return this.start.clone().add(i.multiply(n)).constrain(this.start,this.end)}toJSON(){const{start:t,end:e}=this;return[t,e]}static from(t=new S){if(t instanceof S)return t;if(Array.isArray(t)&&2===t.length)return new S(...t);if("Object"===t.constructor.name)return new S(t.start,t.end);throw new TypeError(`Unexpected type for vector [${typeof t}]`)}}class M extends k{constructor(t=1,e=1,s){super(void 0,s),this.ctx=this.constructor.buildCanvas(t,e)}clear(){if(this.ctx.clearRect(0,0,this.width,this.height),this.options.fill){M.setOpacity(this.ctx,this.options.opacity);const{width:t,height:e}=this;this.ctx.fillStyle=this.options.fill.toString(this.ctx),this.ctx.fillRect(0,0,t,e)}return this}render(){return this.clear(),super.render(this.ctx),this}get width(){return this.ctx.canvas.width}set width(t){this.ctx.canvas.width=+t}get height(){return this.ctx.canvas.height}set height(t){this.ctx.canvas.height=+t}get size(){return new y(this.width,this.height)}get center(){return this.size.divide(2)}getRandomPosition(){return new y(l(this.width),l(this.height))}getImageData(t){let e;return e=t?S.from(t):new S(void 0,[this.width,this.height]),this.render(),this.ctx.getImageData(e.start.x,e.start.y,e.end.x,e.end.y)}setImageData(t,e){const s=y.from(e);this.ctx.putImageData(t,s.x,s.y)}toImage(t,e="image/png"){let s;s=t?S.from(t):new S(void 0,[this.width,this.height]);const i=window.document.createElement("img"),{width:n,height:r}=this,o=s.getDelta();return this.width=o.x,this.height=o.y,i.width=this.width,i.height=this.height,this.ctx.translate(-s.start.x,-s.start.y),this.render(),i.src=this.ctx.canvas.toDataURL(e),this.width=n,this.height=r,i}static buildCanvas(t,e){const s=window.document.createElement("canvas");return s.width=t,s.height=e,s.getContext("2d")}static get defaultOptions(){return{...super.defaultOptions,fill:null,opacity:1}}}class z extends k{constructor(t,e={}){super(t,e),this.options.shadow={...z.defaultOptions.shadow,...e.shadow},this.options.shadow.position=y.from(this.options.shadow.position),this.path=null,this.isClicked=!1,this.isHovered=!1}getOrigin(){return y.from(this.options.origin)}makePath(t){t.save();const[e,s]=this.setContext(t);if(e||s){const i=new window.Path2D;this.trace(i),this.path=i,e&&t.fill(i),s&&t.stroke(i)}return t.restore(),this}setContext(t){const e=this.options.fill,s=this.options.stroke&&this.options.strokeWidth>0;if(e||s){const i=this.getOrigin();t.translate(i.x,i.y),this.options.shadow.color&&(t.shadowColor=this.options.shadow.color.toString(),t.shadowBlur=this.options.shadow.blur,t.shadowOffsetX=this.options.shadow.position.x,t.shadowOffsetY=this.options.shadow.position.y),e&&(t.fillStyle=this.options.fill.toString(t)),s&&(t.lineJoin=this.options.join,t.lineCap=this.options.cap,t.strokeStyle=this.options.stroke.toString(t),t.lineWidth=this.options.strokeWidth)}return[e,s]}trace(){throw new ReferenceError(`Unimplemented trace function in ${this.constructor.name}`)}isHover(t,e=(new M).ctx){if(!this.options.shown)return!1;const s=y.from(t).clone().subtract(this.position),i=s.clone().rotate(-this.options.rotation,this.options.rotationCenter);e.save();const[n,r]=this.setContext(e);if(!n&&!r)return e.restore(),!1;this.path||(this.path=new window.Path2D,this.trace(this.path));let o=n&&e.isPointInPath(this.path,i.x,i.y)||r&&e.isPointInStroke(this.path,i.x,i.y);if(this.options.clip){const t=this.options.clip===k.ITSELF?this:this.options.clip;o=o&&t.isHover(s,e)}return e.restore(),o}static get defaultOptions(){return{...super.defaultOptions,fill:"#000",stroke:null,strokeWidth:2,cursor:z.cursors.default,join:z.joins.miter,origin:new y,shadow:{blur:0,position:new y,color:null}}}static get cursors(){const t={default:"default",none:"none",contextMenu:"context-menu",help:"help",pointer:"pointer",progress:"progress",wait:"wait",cell:"cell",crosshair:"crosshair",text:"text",textVertical:"vertical-text",alias:"alias",copy:"copy",move:"move",noDrop:"no-drop",notAllowed:"not-allowed",grab:"grab",grabbing:"grabbing",allScroll:"all-scroll",colResize:"col-resize",rowResize:"row-resize",nResize:"n-resize",eResize:"e-resize",sResize:"s-resize",wResize:"w-resize",neResize:"ne-resize",seResize:"se-resize",swResize:"sw-resize",nwResize:"nw-resize",ewResize:"ew-resize",nsResize:"ns-resize",neswResize:"nesw-resize",nwseResize:"nwse-resize",zoomIn:"zoom-in",zoomOut:"zoom-out"};return t.link=t.alias,t.verticalResize=t.rowResize,t.horizontalResize=t.colResize,t.topResize=t.nResize,t.rightResize=t.eResize,t.bottomResize=t.sResize,t.leftResize=t.wResize,t}static get joins(){return{miter:"miter",round:"round",bevel:"bevel"}}}class R extends o{constructor(t,e,s){super(t,e),this.key=s}static get events(){return{down:"keydown",up:"keyup"}}static get keys(){return{backspace:"Backspace",enter:"Enter",delete:"Delete",escape:"Escape",control:"Control",shift:"Shift",arrows:{up:"ArrowUp",right:"ArrowRight",down:"ArrowDown",left:"ArrowLeft"},tab:"Tab",alt:"Alt",altGr:"AltGraph",pageUp:"PageUp",pageDown:"PageDown",start:"Home",end:"End",insert:"Insert"}}}class E extends o{constructor(t,e,s){super(t,e),this.position=y.from(s)}static get events(){return{down:"mousedown",up:"mouseup",click:"click",move:"mousemove",hover:"hover",leave:"leave",wheel:"mousewheel",scrollDown:"scrolldown",scrollUp:"scrollup",zoomOut:"zoomout",zoomIn:"zoomin",grab:"grab",drag:"drag",drop:"drop",resize:"resize",rotate:"rotate"}}}const T=Symbol("_listenForEvents");class C extends M{constructor(t=window.document.body,e){const s=t.getBoundingClientRect();t instanceof window.HTMLCanvasElement?(super(null,0,e),this.ctx=t.getContext("2d")):(super(t,0,e),t.appendChild(this.ctx.canvas)),this.cursorPosition=new y,this.containerPosition=new y(s.left+window.scrollX,s.top+window.scrollY),this.isScene=!0,this.isLooped=!1,this.isClicked=!1,this.fps=0,this.lastTick=null,this[T](t)}setCursor(t=z.cursors.default){return this.ctx.canvas.style.cursor=t,this}render(){const t=this.isLooped?window.requestAnimationFrame(this.render.bind(this,void 0)):null;try{super.render(this.ctx)}catch(e){throw window.cancelAnimationFrame(t),this.stopLoop(),e}const e=window.performance.now();return this.isLooped&&this.lastTick&&(this.fps=1e3/(e-this.lastTick)),this.lastTick=e,this}isHover(){return this.options.shown}startLoop(){return this.isLooped=!0,this.render(),this}stopLoop(){return this.isLooped=!1,this.fps=0,this}hide(){return this.ctx.canvas.style.visibility="hidden",super.hide()}show(){return this.ctx.canvas.style.visibility="",super.show()}static from(t){return new C(void 0,t.options)}static buildCanvas(t=window.document.body){if(t){const{scrollWidth:e,scrollHeight:s}=t,i=super.buildCanvas(e,s);return i.canvas.style.display="block",i.canvas.style.position="absolute",i}return null}static get defaultOptions(){return{...super.defaultOptions,cursor:z.cursors.default}}static get events(){return{...super.events,change:"change-scene"}}}C.prototype[T]=function(t){if(this.isReady)throw new EvalError("Can't rebind event a second time.");let e=null,s=null;const i={[E.events.down]:(t,e)=>{t.isClicked=!0,s=e},[E.events.move]:(t,i)=>{s&&(t.isClicked=t.isClicked&&i.distance(s)<10),t!==e&&(e&&(e.isHovered=!1,e.isAncestorOf(t)||e.fire(new E(E.events.leave,e,i))),e=t),t.isHovered||(t.isHovered=!0,t.fire(new E(E.events.hover,t,i))),this.setCursor(t.options.cursor),this.cursorPosition.set(i)},[E.events.up]:(t,e)=>{s=null,t.isClicked&&(t.fire(new E(E.events.click,t,e)),t.isClicked=!1)},[E.events.wheel]:(t,e,s)=>{const i=E.events,n=s.deltaY>0?[i.scrollDown,i.zoomOut]:[i.scrollUp,i.zoomIn];t.fire(new E(n[0],t,e)).fire(new E(n[1],t,e))},mouseout:(t,e)=>{t.fire(new E(E.events.leave,t,e))}};Object.keys(i).forEach(e=>{t.addEventListener(e,t=>{if(this.options.shown){const s=new y(t.clientX,t.clientY).subtract(this.containerPosition).add(window.scrollX,window.scrollY),n=this.getTarget(s,this.ctx);n&&(n.fire(new E(e,n,s)),i[e]instanceof Function&&i[e](n,s,t))}},{passive:!0})});const n={[R.events.down]:null,[R.events.up]:null};Object.keys(n).forEach(e=>{t.addEventListener(e,t=>{this.options.shown&&(this.fire(new R(e,this,t.key)),n[e]instanceof Function&&n[e](t))})})};class A extends z{constructor(t,e=[],s){if(e.length<2)throw new RangeError(`A polygon can't have less than 3 vertices, but only ${e.length} given.`);super(t,s),this.points=e.map(t=>y.from(t))}trace(t){return this.points.concat([new y]).concat(...this.points.slice(0,2)).forEach(e=>t.lineTo(e.x,e.y)),this}toJSON(){const{points:t}=this;return{...super.toJSON(),points:t}}static from(t){return new A(t.position,t.points,t.options)}}class P extends A{constructor(t,e,s=0,i){super(t,P.getRotatingPoints(e,s),i),this.radius=s}trace(t){return this.points.concat(...this.points.slice(0,2)).forEach(e=>t.lineTo(e.x,e.y)),this}toJSON(){const{points:t,radius:e}=this,s={...super.toJSON(),nbSides:t.length,radius:e};return delete s.points,s}static from(t){return new P(t.position,t.nbSides,t.radius,t.options)}static getRotatingPoints(t,e,s=0){const i=s-.25,n=[];for(let s=0;s<t;++s){const r=(s/t+i)*u;n.push(new y(Math.cos(r)*e,Math.sin(r)*e))}return n}}class N extends z{constructor(t,e=0,s=0,i){super(t,i),this.width=e,this.height=s}trace(t){return t.rect(0,0,this.width,this.height),this}getOrigin(){const{origin:t}=this.options;if("string"==typeof t){const{origins:e}=N,s=new y;return t===e.center?s.set(-this.width/2,-this.height/2):s.set([e.topRight,e.bottomRight].includes(t)&&-this.width||0,[e.bottomLeft,e.bottomRight].includes(t)&&-this.height||0),s}return super.getOrigin()}toJSON(){const{width:t,height:e}=this;return{...super.toJSON(),width:t,height:e}}static from(t){return new N(t.position,t.width,t.height,t.options)}static get origins(){return{topLeft:"topLeft",topRight:"topRight",center:"center",bottomLeft:"bottomLeft",bottomRight:"bottomRight"}}}class H extends o{static get events(){return{ready:"ready",error:"error"}}}var I=function(t){return document.defaultView.getComputedStyle(t||document.body).direction},L=s(3),J=s.n(L);function j(t){return Array.isArray(t)?t.reduce((t,e)=>t.concat(e.split("\n")),[]):t.split("\n")}const D=(()=>{const t=document.createElement("canvas").getContext("2d"),e={};return(s,i)=>{const n=J()(`${s}${JSON.stringify(i)}`);if(void 0!==e[n])return e[n];t.font=G.getFontDefinition(i);const r=j(s),o=i.fontSize*i.lineHeight*r.length,a={width:r.reduce((e,s)=>Math.max(e,t.measureText(s).width),0),height:o};return e[n]=a,a}})();class G extends z{constructor(t,e="",s){super(t,s),this.lines=[],this.text=e;const i=new H(H.events.ready,this);/^(\w+:)?\/\//.test(this.options.font)?G.load(this.options.font).then(t=>{this.options.font=t,this.fire(i)}):this.fire(i)}get text(){return this.lines.join("\n")}set text(t){this.lines=j(t)}makePath(t){const e=this.options;if(this.text.length&&(e.fill||e.stroke&&e.strokeWidth>0)){t.save();const s=G.measure("M",this.options).height,i=s/e.lineHeight,n=i*((e.lineHeight-1)/2);this.setContext(t),e.underscore&&t.beginPath();const r=this.getAlignOffset();this.lines.forEach((o,a)=>{const h=a*s+n;if(e.fill&&t.fillText(o,r*this.width,h),e.stroke&&t.strokeText(o,r*this.width,h),e.underscore){const{width:s}=G.measure(o,e),n=r*(this.width-s);t.moveTo(n,h+i),t.lineTo(n+s,h+i)}}),e.underscore&&(t.lineWidth=i*(e.bold?.07:.05),t.strokeStyle=e.fill||e.stroke,t.stroke(),t.closePath()),t.restore()}return this}setContext(t){const[e,s]=super.setContext(t);return(e||s)&&(t.font=G.getFontDefinition(this.options),t.textAlign=this.options.align,t.textBaseline="top"),[e,s]}trace(t){return t.rect(0,0,this.width,this.height),this.path=t,t}getAlignOffset(){const{align:t}=this.options;let e=0;if(t===G.alignments.center)e=.5;else if(t===G.alignments.right)e=1;else if(t===G.alignments.start||t===G.alignments.end){const s=this.getRoot();if(s.isScene){const i=I(s.ctx.canvas);(t===G.alignments.start&&"rtl"===i||t===G.alignments.end&&"ltr"===i)&&(e=1)}}return e}getOrigin(){return super.getOrigin().clone().add(-this.getAlignOffset()*this.width,0)}getMeasures(){return G.measure(this.text,this.options)}get width(){return this.getMeasures().width}get height(){return this.getMeasures().height}toJSON(){const{text:t}=this;return{...super.toJSON(),text:t}}static from(t){return new G(t.position,t.text,t.options)}static load(t){if(Array.isArray(t))return Promise.all(t.map(t=>G.load(t)));const e=t.replace(/\W/g,"-"),s=new window.FontFace(e,`url(${t})`);return window.document.fonts.add(s),s.load().then(()=>e)}static getFontDefinition(t){return`${t.bold?"bold ":""}${t.italic?"italic ":""}${t.fontSize}px ${t.font}`}static measure(t,e){const s=Array.isArray(t)?t.join("\n"):t,i={...this.defaultOptions,...e};return D(s,i)}static get defaultOptions(){return{...super.defaultOptions,font:"sans-serif",fontSize:20,align:G.alignments.start,bold:!1,italic:!1,underscore:!1,lineHeight:1}}static get alignments(){return{left:"left",right:"right",center:"center",start:"start",end:"end"}}}class q extends z{constructor(t,e,s){super(t,s);const i=e.slice(0,2).every(t=>void 0===t||"number"==typeof t)?[y.from(e)]:e.map(t=>y.from(t));this.points=i}trace(t){return t.moveTo(0,0),this.points.forEach(e=>t.lineTo(e.x,e.y)),this}toJSON(){const{points:t}=this;return{...super.toJSON(),points:t}}static from(t){return new q(t.position,t.points,t.options)}static get defaultOptions(){const t={...super.defaultOptions,cap:q.caps.round,join:q.joins.round,fill:null,cursor:null};return t.stroke=super.defaultOptions.fill,t}static get caps(){return{butt:"butt",round:"round",square:"square"}}}class $ extends z{constructor(t,e=0,s=0,i=0,n=.5,r){super(t,r),this.horizontalRadius=e,this.verticalRadius=s,this.startAngle=i,this.endAngle=n}trace(t){const e=(this.startAngle+-.25)*u,s=(this.endAngle+-.25)*u;return t.ellipse(0,0,this.horizontalRadius,this.verticalRadius,0,e,s),this}toJSON(){const{horizontalRadius:t,verticalRadius:e,startAngle:s,endAngle:i}=this;return{...super.toJSON(),horizontalRadius:t,verticalRadius:e,startAngle:s,endAngle:i}}static from(t){return new $(t.position,t.horizontalRadius,t.verticalRadius,t.startAngle,t.endAngle,t.options)}static get defaultOptions(){return{...q.defaultOptions,join:null}}static get caps(){return q.caps}}class _ extends ${constructor(t,e,s,i){super(t,e,s,0,1,i)}toJSON(){const t=super.toJSON();return delete t.startAngle,delete t.endAngle,t}static from(t){return new _(t.position,t.horizontalRadius,t.verticalRadius,t.options)}static get defaultOptions(){return z.defaultOptions}}class F extends _{constructor(t,e,s){super(t,e,e,s)}get radius(){return this.horizontalRadius}set radius(t){this.horizontalRadius=t,this.verticalRadius=t}trace(t){return t.arc(0,0,this.radius,0,u),this}toJSON(){const{radius:t}=this,e={...super.toJSON(),radius:t};return delete e.horizontalRadius,delete e.verticalRadius,e}static from(t){return new F(t.position,t.radius,t.options)}}class U extends q{constructor(t,e,s=U.defaultTension,i){super(t,e,i),this.tension=s}trace(t){return 1===this.points.length||h(this.tension,0)?super.trace(t):(t.moveTo(0,0),U.splineThrough(t,[new y(0,0)].concat(this.points),this.tension)),this}toJSON(){const{tension:t}=this;return{...super.toJSON(),tension:t}}static from(t){return new U(t.position,t.points,t.tension,t.options)}static get defaultTension(){return.2}static splineThrough(t,e,s=U.defaultTension){if(e.length<2)throw new RangeError(`Need at least 2 points to spline, but only ${e.length} given.`);const i=e.map(t=>y.from(t));if(2===i.length)return void t.lineTo(i[1].x,i[1].y);const n=U.getControlPoint;let r=[null,i[0]];for(let e=1,o=i.length;e<o;++e){const a=e<o-1?n(i.slice(e-1,e+2),s):[i[e],null];t.bezierCurveTo(r[1].x,r[1].y,a[0].x,a[0].y,i[e].x,i[e].y),r=a}}static getControlPoint(t,e=U.defaultTension){if(t.length<3)throw new RangeError(`Need exactly 3 points to compute control points, but ${t.length} given.`);const s=t.map(t=>y.from(t)),i=s[2].clone().subtract(s[0]).multiply(e);return[s[1].clone().subtract(i),s[1].clone().add(i)]}}class W extends U{constructor(t,e){super(t.position,[],.2,{stroke:"#333",zIndex:-10}),this.from=t,this.to=e,this.middle=this.getCenter()}getCenter(){return this.position.clone().lerp(this.to.position,.5)}trace(...t){const e=this.getCenter();this.middle.lerp(e,.1),this.points=[this.middle,this.to.position].map(t=>t.clone().subtract(this.position)),this.children.forEach(t=>{t.position.lerp(t.options.destination,.08),t.position.distance(t.options.destination)<t.radius&&t.delete()}),super.trace(...t)}getOther(t){return t===this.from?this.to:t===this.to?this.from:null}sendFrom(t){const e=this.getOther(t);e.value+=1;const s=new F(t.position.clone().subtract(this.position),10,{fill:"#99ff66",stroke:"#333",zIndex:-5,destination:e.position.clone().subtract(this.position)});this.add(s)}}const B="#333",Y=Symbol("_value");class X extends F{constructor(t,e,s=0){super(t,e,{stroke:B});const i=e/2,n=new F([0,4-i],i,{fill:"#fff",stroke:B,cursor:"pointer"});this.text=new G([0,-i/2],"0",{align:G.alignments.center,fill:B,fontSize:i,cursor:"pointer"}),n.add(this.text),this.add(n),this.links=[],this[Y]=null,this.value=s,this.on("click",()=>this.click()),this.draggable()}click(){this.value-=this.links.length,this.links.forEach(t=>t.sendFrom(this)),this.fire(new o("lends",this))}delete(){this.links.forEach(t=>t.delete()),super.delete()}get value(){return this[Y]}set value(t){this[Y]=Math.round(t),this.text.text=this[Y].toString(),this[Y]<0?this.options.fill="#ff7365":this.options.fill="#99ff66"}linkTo(t){if(t&&!this.links.find(e=>e.getOther(this)===t)){const e=new W(this,t);return this.links.push(e),t.links.push(e),e}return null}toJSON(){const{position:t,links:e,value:s}=this;return{position:t,links:e,value:s}}}function V(t,e=[],s=0){return{position:y.from(t),links:e,value:s}}const Z=localStorage,K=btoa,Q=atob;const tt=t=>{const e=K(function(t){return Math.random().toString(36).slice(-t)}(7)+K(JSON.stringify(t)));Z.setItem("socsim",e)};var et=s(1),st=s.n(et);function it(t,e){return(t>>8*e&255)/255}function nt(t){return c(255*t+.5)}class rt{constructor(...t){this.red=0,this.green=0,this.blue=0,this.alpha=1,this.set(...t)}clone(){return new rt(this)}get array(){return[this.red,this.green,this.blue]}get rgb(){return`#${this.array.map(t=>(function(t){return nt(t).toString(16).padStart(2,"0")})(t)).join("")}`}get rgba(){return`rgba(${this.array.map(t=>nt(t)).concat(this.alpha).join(",")})`}get name(){return st.a.rgb.keyword(this.array.map(t=>nt(t)))}set(...t){if(t.length>0&&t.length<3){const e=t[0];if(e instanceof rt)this.red=e.red,this.green=e.green,this.blue=e.blue,this.alpha=e.alpha;else{let s=e;if("string"==typeof e)if(e.startsWith("#")){const t=e.substr(1),i=t.length<4?t.split("").map(t=>t.repeat(2)).join(""):t;s=Number.parseInt(i,16)}else{const t=st.a.keyword.rgb(e.toLocaleLowerCase())||[0,0,0];this.red=t[0]/255,this.green=t[1]/255,this.blue=t[2]/255}"number"==typeof s&&(this.red=it(s,2),this.green=it(s,1),this.blue=it(s,0));const i=t[1];void 0!==i&&(this.alpha=a(i,0,1))}}else if(t.length>2){this.red=a(t[0],0,1),this.green=a(t[1],0,1),this.blue=a(t[2],0,1);const e=t[3];void 0!==e&&(this.alpha=a(e,0,1))}return this}grey(){const t=[.299,.587,.114],e=m(...this.array.map((e,s)=>e*t[s]));return this.set(e,e,e)}hue(t){const e=st.a.rgb.hsl(this.array.map(t=>nt(t)));return e[0]=t%1*360,this.set(...st.a.hsl.rgb(e).map(t=>t/255))}saturation(t){const e=m(Math.min(...this.array),Math.max(...this.array));return this.set(...this.array.map(s=>e+t*(s-e)))}lightness(t){const e=t<.5?e=>e*t:e=>e+(1-e)*(t-.5)*2;return this.set(...this.array.map(e))}reverse(){return this.set(...this.array.map(t=>1-t))}level(t){return this.set(...this.array.map(e=>c(e*t+1)/(t+1)))}lerp(t,e){const s=rt.from(t),i=this.array.concat(this.alpha),n=s.array.concat(s.alpha);return this.set(...i.map((t,s)=>v(t,n[s],e)))}toString(){return h(this.alpha,1)?this.rgb:this.rgba}toJSON(){return this.array.concat(this.alpha)}static from(...t){const e=t[0];return e instanceof rt||null===e?e:new rt(...t)}}let ot=null;const at=()=>ot,ht=t=>(ot&&ot.hide().stopLoop(),t.show().startLoop(),ot=t,t),lt=(t,e=window.document.body)=>{let s;e instanceof window.HTMLCanvasElement?s=e:(({canvas:s}=C.buildCanvas(e)),e.appendChild(s));const i=Object.keys(t),n={};return i.forEach(e=>{const i=new C(s);t[e](i),n[e]=i,i.hide(),i.on(C.events.change,t=>ht(n[t.target]))}),ht(n[i[0]])};class ct extends z{constructor(t,e,s,i,n){super(t,e.options),this.base=e,this.updater=n,this.data=[...new Array(s)].map((t,e)=>{const s={...ct.defaultData,...i(e)};return s.position=y.from(s.position),s.scale=y.from(s.scale),s})}trace(t){const e=new window.Path2D;this.base.trace(e);const s=new window.DOMMatrix,{cos:i,sin:n}=Math;return this.data.forEach((r,o)=>{this.updater&&this.updater(r,o);const{scale:a,position:h,rotation:l}=r,c=l*u;s.a=i(c)*a.x,s.b=n(c)*a.x,s.c=-n(c)*a.y,s.d=i(c)*a.y,s.e=h.x,s.f=h.y,t.addPath(e,s)}),this}isHover(){return!1}toJSON(){const{base:t,data:e}=this;return{...super.toJSON(),base:t,data:e}}static from(t){const e=from(t.base),s=new ct(t.position,e,0);return s.data=t.data,s}static get defaultData(){return{position:new y,rotation:0,scale:new y(1,1)}}}class ut extends P{constructor(t,e,s){super(t,3,e,s)}toJSON(){const t=super.toJSON();return delete t.nbSides,t}static from(t){return new ut(t.position,t.radius,t.options)}}class dt extends P{constructor(t,e,s=5,i=.5,n){super(t,s,e,n);const r=this.radius*i;P.getRotatingPoints(s,r,.5/s).forEach((t,e)=>this.points.splice(2*e+1,0,t)),this.bevelRatio=i}toJSON(){const{points:t,bevelRatio:e}=this,s={...super.toJSON(),nbBranches:t.length/2,bevelRatio:e};return delete s.nbSides,s}static from(t){return new dt(t.position,t.radius,t.nbBranches,t.bevelRatio,t.options)}}class pt extends N{constructor(t,e,s){super(t,e,e,s)}set size(t){this.width=t,this.height=t}get size(){return this.width}toJSON(){const{size:t}=this,e={...super.toJSON(),size:t};return delete e.height,delete e.width,e}static from(t){return new pt(t.position,t.size,t.options)}}const gt=Symbol("_url");class ft extends N{constructor(t,e,s=null,i=null,n){super(t,s,i,n),this.file=null,this.isLoaded=!1,this.ratio=0,this[gt]=null,this.url=e}set url(t){this.url!==t&&(this.file=null,this.isLoaded=!1,this[gt]=t,t&&ft.load(t).then(t=>{this.file=t,this.isLoaded=!0,this.ratio=t.width/t.height,null===this.width&&null===this.height?this.restoreSize():null===this.width?this.width=this.height*this.ratio:null===this.height&&(this.height=this.width/this.ratio),this.fire(new H(H.events.ready,this))}).catch(()=>{this.fire(new H(H.events.error,this))}))}get url(){return this[gt]}makePath(t){if(this.isLoaded){super.makePath(t);const e=this.getOrigin();t.drawImage(this.file,e.x,e.y,this.width,this.height)}return this}restoreSize(){this.isLoaded&&(this.width=this.file.width,this.height=this.file.height)}toJSON(){const{url:t}=this;return{...super.toJSON(),url:t}}static from(t){return new ft(t.position,t.url,t.width,t.height,t.options)}static load(t){return Array.isArray(t)?Promise.all(t.map(t=>ft.load(t))):new Promise((e,s)=>{const i=window.document.createElement("img");i.crossOrigin="Anonymous",i.src=t,i.addEventListener("load",()=>e(i)),i.addEventListener("error",()=>s(new URIError(`Fail to load ${t}.`)))})}static get defaultOptions(){return{...super.defaultOptions,fill:null,description:""}}}class wt{constructor(t,e){this.action=t,this.target=y.from(e)}execute(t,e){return this.action.call(this,t,this.target,e),this.target}toJSON(){throw new ReferenceError("Unimplemented toJSON function in Instruction")}static from(){throw new ReferenceError("Unimplemented from function in Instruction")}}class mt extends z{constructor(t,e,s=!0,i){super(t,i),s||(this.options=new q(this.position,[],i).options),this.instructions=e,this.isClosed=s,this.closing=mt.lineTo(new y)}trace(t){let e=new y;const s=this.instructions.slice();if(Array.isArray(s)){if(this.isClosed){const i=this.instructions[this.instructions.length-1].target;t.moveTo(i.x,i.y),s.unshift(this.closing),s.push(this.closing),e=i}else t.moveTo(0,0);s.forEach(s=>e=s.execute(t,e))}else if("string"==typeof s){const e=new window.Path2D(`M0 0 ${s}${this.isClosed?" Z":""}`);t.addPath(e)}return this}isHover(t,e){return super.isHover(t,e)}toJSON(){const{instructions:t,isClosed:e}=this;return{...super.toJSON(),instructions:t,isClosed:e}}static from(t){return new mt(t.position,t.instructions.map(t=>wt.from(t)),t.isClosed,t.options)}static lineTo(t){return new wt((t,e)=>t.lineTo(e.x,e.y),t)}static moveTo(t){return new wt((t,e)=>t.moveTo(e.x,e.y),t)}static quarterTo(t,e){return mt.arcTo(t,.25,4/3*(Math.sqrt(2)-1),e)}static halfTo(t,e){return mt.arcTo(t,.5,4/3,e)}static arcTo(t,e,s,i=!0){return new wt((t,n,r)=>{const o=n.distance(r),a=o/2,h=e/2*(i?1:-1),l=n.clone().subtract(r).rotate(-h).divide(o).multiply(s*a).add(r),c=r.clone().subtract(n).rotate(h).divide(o).multiply(s*a).add(n);mt.bezierTo(n,l,c).execute(t,r)},t)}static quadTo(t,e){const s=y.from(e);return new wt((t,e)=>{t.quadraticCurveTo(s.x,s.y,e.x,e.y)},t)}static bezierTo(t,e,s){const i=y.from(e),n=y.from(s);return new wt((t,e)=>{t.bezierCurveTo(i.x,i.y,n.x,n.y,e.x,e.y)},t)}static splineThrough(t,e){const s=t.map(t=>y.from(t)),i=s[s.length-1];return new wt((t,n,r)=>{const o=y.from(i).clone().subtract(n),a=s.map(t=>t.clone().subtract(o));U.splineThrough(t,[r].concat(a),e)},i)}static waveTo(t,e){throw new ReferenceError("This function has yet to be implemented.")}static sinTo(t,e,s){throw new ReferenceError("This function has yet to be implemented.")}}class bt extends z{constructor(t,e,s){super(t,s),this.radius=e}trace(t){t.moveTo(0,-.4*this.radius);const e=[[-.4,-.9,-1,-.6,-1,0],[-1,.4,-.6,.6,0,1],[.6,.6,1,.4,1,0],[1,-.6,.4,-.9,0,-.4]];return e.concat(e.slice(0,1)).forEach(e=>t.bezierCurveTo(...e.map(t=>t*this.radius))),this}toJSON(){const{radius:t}=this;return{...super.toJSON(),radius:t}}static from(t){return new bt(t.position,t.radius,t.options)}}class vt extends k{constructor(t,e){super(t,e),this.background=new N(void 0,0,0,{fill:this.options.background,stroke:this.options.border,strokeWidth:2,cursor:z.cursors.pointer}),this.add(this.background),this.background.on(E.events.hover,()=>{this.background.options.fill=this.options.hover}).on(E.events.leave,()=>{this.background.options.fill=this.options.background}).on(E.events.click,t=>{this.click(t.position.clone().subtract(this.getAbsolutePosition()))}),this.on(k.events.attach,()=>this.value=this.options.value,!0)}makePath(t){const e=this.background.options.origin;this.background.options.origin=this.options.origin;const s=this.background.getOrigin();return this.background.options.origin=e,t.translate(s.x,s.y),super.makePath()}get value(){throw new ReferenceError(`Unimplemented get value function in ${this.constructor.name}`)}set value(t){throw new ReferenceError(`Unimplemented set value function in ${this.constructor.name}`)}click(){this.fire(new o(vt.events.change,this))}isHover(t,e){return this.options.shown&&this.background.isHover(this.position.clone().add(t),e)}toJSON(){const t=super.toJSON();return t.options=t.options||{},t.options.value=this.value,t.children=t.children.slice(1),t}static from(t){return new this(t.position,t.options)}static get defaultOptions(){return{...super.defaultOptions,value:null,fill:"#444",background:"#f6f6f6",border:"#aaa",hover:"#dcdcdc"}}static get events(){return{...super.events,change:"change"}}}class yt extends vt{constructor(t,e){super(t,e),this.text=new G(void 0,this.options.value,{fill:this.options.fill,cursor:this.background.options.cursor,font:this.options.font,fontSize:this.options.fontSize,align:this.options.align,bold:this.options.bold,italic:this.options.italic,underscore:this.options.underscore,lineHeight:this.options.lineHeight}),this.background.add(this.text)}click(){}get value(){return this.text.text}set value(t){this.text.text=t;const e=this.text.getMeasures(),s=e.height*yt.MARGIN;this.background.width=e.width+4*s,this.background.height=e.height+2*s,this.text.position.set(2*s,s),this.text.options.origin.set(this.text.getOrigin().multiply(-1))}static get defaultOptions(){return{...G.defaultOptions,...super.defaultOptions,value:""}}static get MARGIN(){return.2}}class xt extends vt{constructor(t,e){super(t,e),this.background.width=this.options.size,this.background.height=this.options.size;const s=this.options.size*xt.MARGIN;this.fill=new pt([s,s],this.options.size-2*s,{fill:this.options.fill,shown:this.options.value,cursor:this.background.options.cursor}),this.background.add(this.fill)}click(){this.toggle(),super.click()}toggle(t=!this.value){return this.value=t,t}get value(){return this.fill.options.shown}set value(t){t?this.fill.show():this.fill.hide()}static get defaultOptions(){return{...super.defaultOptions,size:20,value:!1}}static get MARGIN(){return.2}}const kt=Symbol("_selected");class Ot extends vt{constructor(t,e,s){if(!e.length)throw new RangeError("Options list should have at least one item.");super(t,s),this[kt]=0;const i={cursor:z.cursors.pointer,fill:this.options.fill,font:this.options.font,fontSize:this.options.fontSize,align:this.options.align,bold:this.options.bold,italic:this.options.italic,underscore:this.options.underscore,lineHeight:this.options.lineHeight,origin:new y},n=G.measure("M",i).height*Ot.MARGIN;this.display=new G([2*n,n],"",i),this.background.add(this.display),this.optionsList=e.map(t=>new G([2*n,n],t||"",i));const r=Math.max(...this.optionsList.map(t=>t.width));this.background.width=r+6*n,this.background.height=this.optionsList[0].height+2*n,i.origin.set(r*this.display.getAlignOffset(),0),this.optionsContainer=new N(void 0,this.background.width,0,this.background.options),this.optionsContainer.hide(),this.add(this.optionsContainer);let a=0;this.optionsList.forEach((t,e)=>{const s=new N([1,a+1],r+6*n-2,t.height+2*n,{fill:this.options.background,cursor:z.cursors.pointer});a+=s.height,s.on(E.events.hover,()=>s.options.fill=this.options.hover).on(E.events.leave,()=>s.options.fill=this.options.background).on(E.events.click,()=>{this.value=e,this.fire(new o(Ot.events.change,this))}),s.add(t),this.optionsContainer.add(s)}),this.optionsContainer.height=a+2;const h=new ut([r+3.5*n,this.background.height/2],n,{fill:this.options.fill,rotation:.5,cursor:z.cursors.pointer});this.background.add(h)}get value(){return this[kt]}set value(t){this[kt]=a(t,0,this.optionsList.length-1),this.display.text=this.optionsList[this[kt]].text,this.display.options.origin.set(this.optionsList[this[kt]].options.origin),this.optionsContainer.hide();const e=this.optionsList[0].height*Ot.MARGIN;this.optionsContainer.position.set(0,-this[kt]*(this.optionsList[0].height+2*e))}click(){this.optionsContainer.show()}toJSON(){const t=super.toJSON();return t.values=this.optionsList.map(t=>t.text),t}static from(t){return new Ot(t.position,t.values,t.options)}static get defaultOptions(){return{...G.defaultOptions,...super.defaultOptions,value:0}}static get MARGIN(){return.2}}z.prototype.draggable=function(t){if(this.isDraggable)throw new Error("Component can't be both rotatable and draggable.");const e=this.options.cursor===z.cursors.default;e&&(this.options.cursor=z.cursors.grab),this.isDraggable=!0,this.isDragged=!1;const s={x:!0,y:!0,...t};s.constrain&&(s.constrain=S.from(s.constrain));let i=null,n=null;return this.on(E.events.down,t=>{e&&(this.options.cursor=z.cursors.grabbing),i=t.position,n=this.position.clone(),this.isDragged=!0,this.fire(new E(E.events.grab,this,this.position.clone()))},!0),this.getScene().then(t=>t.on(E.events.move,t=>{if(this.isDragged&&i){const e=t.position.clone().subtract(i),r=n.clone().add(s.x&&e.x,s.y&&e.y);this.position.set(r),s.constrain&&this.position.constrain(s.constrain.start,s.constrain.end),this.fire(new E(E.events.drag,this,this.position.clone()))}}).on(E.events.up,()=>{e&&(this.options.cursor=z.cursors.grab),this.isDragged&&i&&(i=null,this.isDragged=!1,this.fire(new E(E.events.drop,this,this.position.clone())))})),{set x(t){s.x=t},set y(t){s.y=t},set constrain(t){s.constrain=t?S.from(t):t}}};const St=Symbol("_constrainer"),Mt=Symbol("_moveHandle");class zt extends vt{constructor(t,e){super(t,e),this.background.width=this.width,this.background.height=zt.HEIGHT;const s=new k(new y(zt.HEIGHT/2,zt.HEIGHT/2));this.background.add(s),this.handle=new F(new y(0,0),(zt.HEIGHT-2)/2,{fill:this.options.fill,cursor:z.cursors.ewResize}),s.add(this.handle),this[St]=new S(new y(0,0),new y(this.width-zt.HEIGHT,0)),this.handle.draggable({constrain:this[St]}),this.handle.on(E.events.drag,()=>this.fire(new o(zt.events.change,this)),!0)}click(t){this.handle.position.set(t.x-zt.HEIGHT/2,0).constrain(this[St].start,this[St].end),super.click()}set width(t){if(t<zt.HEIGHT)throw new RangeError(`Slider is too small, minimum is ${zt.HEIGHT}px.`);this.options.width=t,this.background.width=t,this[St].end=new y(this.width-zt.HEIGHT,0),this[Mt](this.value)}get width(){return this.options.width}get value(){const t=this.options.max-this.options.min,e=this.handle.position.x/(this.width-zt.HEIGHT);return this.options.min+t*e}set value(t){this[Mt](a(t,this.options.min,this.options.max))}static get defaultOptions(){return{...super.defaultOptions,min:0,max:10,value:0,width:200}}static get HEIGHT(){return 20}}zt.prototype[Mt]=function(t){const e=this.options.max-this.options.min;this.handle.position.x=(this.width-zt.HEIGHT)*((t-this.options.min)/e)};const Rt=Symbol("_value");class Et extends vt{constructor(t,e){super(t,e),this.background.width=this.width,this.background.height=Et.HEIGHT,this.background.options.cursor=null,this.background.removeListener([E.events.hover,E.events.leave]),this.progress=new N([1,1],0,Et.HEIGHT-2,{fill:this.options.fill}),this.background.add(this.progress),this.options.speed<1&&this.progress.on(Et.events.draw,()=>{const t=(this.background.width-2)*this.value;this.progress.width+=(t-this.progress.width)*this.options.speed**2},!0),this[Rt]=null}click(){}get width(){return this.options.width}set width(t){if(t<Et.HEIGHT)throw new RangeError(`Progress-bar is too small, minimum is ${Et.HEIGHT}px.`);this.options.width=t,this.background.width=t-2}get value(){return this[Rt]}set value(t){this[Rt]=a(t,0,1),this.options.speed>=1&&(this.progress.width=(this.background.width-2)*this.value)}static get defaultOptions(){return{...super.defaultOptions,value:0,width:200,speed:.3}}static get HEIGHT(){return 20}}class Tt extends ${constructor(t,e,s,i,n){super(t,e,e,s,i,n)}trace(t){return t.moveTo(0,0),super.trace(t)}}const Ct=Symbol("_value");class At extends vt{constructor(t,e){super(t,e),this.background.delete(),this.background=new F(void 0,this.options.radius,{fill:this.options.background,stroke:this.options.border,strokeWidth:2,cursor:null}),this.add(this.background),this.progress=new Tt(void 0,this.background.radius-1,0,0,{fill:this.options.fill,stroke:null}),this.background.add(this.progress),this.options.speed<1&&this.progress.on(At.events.draw,()=>{this.progress.endAngle+=(this.value-this.progress.endAngle)*this.options.speed**2},!0),this[Ct]=null}click(){}get radius(){return this.options.radius}set radius(t){this.options.radius=t,this.background.radius=t,this.progress.radius=t-1}get value(){return this[Ct]}set value(t){this[Ct]=a(t,0,1),this.options.speed>=1&&(this.progress.endAngle=this.value)}static get defaultOptions(){return{...super.defaultOptions,value:0,radius:100,speed:.3}}}z.prototype.rotatable=function(){if(this.isDraggable)throw new Error("Component can't be both draggable and rotatable.");const t=this.options.cursor===z.cursors.default;t&&(this.options.cursor=z.cursors.grab),this.isRotatable=!0,this.isRotated=!1;let e=null,s=null;this.on(E.events.down,i=>{t&&(this.options.cursor=z.cursors.grabbing),e=this.options.rotation,s=i.position.subtract(this.getAbsolutePosition()).angle,this.isRotated=!0,this.fire(new E(E.events.grab,this,i.position))},!0),this.getScene().then(i=>i.on(E.events.move,t=>{if(null!==e){const i=this.getAbsolutePosition();this.options.rotation=e+t.position.subtract(i).angle-s,this.fire(new E(E.events.rotate,this,t.position))}}).on(E.events.up,i=>{t&&(this.options.cursor=z.cursors.grab),null!==e&&this.isRotated&&(e=null,s=null,this.isRotated=!1,this.fire(new E(E.events.drop,this,i.position)))}))};class Pt extends vt{constructor(t,e){super(t,e),this.background.delete(),this.background=new F(void 0,this.options.radius,{fill:this.options.background,stroke:this.options.border,strokeWidth:2}),this.add(this.background);const s=this.options.radius*Pt.NOTCH_SIZE,i=this.options.radius/3,n=new q([0,-i],[[0,-this.options.radius+i+s]],{stroke:this.options.fill,strokeWidth:s,cursor:z.cursors.grab});this.background.add(n).on(E.events.rotate,()=>this.fire(new o(Pt.events.change,this)),!0).rotatable()}click(){}get value(){return b(g(this.background.options.rotation,1),0,1,this.options.min,this.options.max)}set value(t){this.background.options.rotation=g(b(t,this.options.min,this.options.max,0,1),1)}static get defaultOptions(){return{...super.defaultOptions,min:0,max:10,value:0,radius:100}}static get NOTCH_SIZE(){return.09}}N.prototype.resizable=function(t){if(this.options.rotation%1!=0)throw new EvalError("Resizable don't support rotation.");const e=this.getOrigin();if(0!==e.x||0!==e.y)throw new EvalError("Resizable don't support other origin than [0, 0] or topLeft.");this.isResizable=!0;const s={x:!0,y:!0,handle:new A([this.width,this.height],[[-15,0],[0,-15]],{fill:"gold",cursor:z.cursors.seResize}),...t};if((!s.x||!s.y)&&this instanceof pt)throw new TypeError("Square should be resizable in both x and y axis.");this.add(s.handle);const i=s.handle.position.clone().multiply(-1).add(this.width,this.height),n=s.handle.draggable(s);return s.handle.on(E.events.drag,()=>{this instanceof pt?(s.handle.position.add(i),this.size=(s.handle.position.x+s.handle.position.y)/2,s.handle.position.set(this.size).subtract(i)):(s.x&&(this.width=s.handle.position.x+i.x),s.y&&(this.height=s.handle.position.y+i.y)),this.fire(new E(E.events.resize,this,s.handle.position))},!0),n};var Nt=s(0);const Ht={Container:k,Particles:ct,Scene:C,Arc:$,Ellipse:_,Circle:F,Line:q,Spline:U,Polygon:A,RegularPolygon:P,Triangle:ut,Star:dt,Rectangle:N,Square:pt,Image:ft,Text:G,Path:mt,Position:y,Vector:S,Select:Ot,Slider:zt,Checkbox:xt,Button:yt,ProgressBar:Et,ProgressPie:At,Knob:Pt,Color:rt,LinearGradient:class{constructor(t,e,s){this.from=y.from(t),this.to=y.from(e),this.colorStops=s}toString(t){const e=y.from(this.from),s=y.from(this.to),i=t.createLinearGradient(e.x,e.y,s.x,s.y);return Object.keys(this.colorStops).forEach(t=>i.addColorStop(t,this.colorStops[t].toString())),i}},RadialGradient:class{constructor(t,e,s){this.position=y.from(t),this.radius=e,this.colorStops=s}toString(t){const e=y.from(this.position),s=t.createRadialGradient(e.x,e.y,0,e.x,e.y,this.radius);return Object.keys(this.colorStops).forEach(t=>s.addColorStop(t,this.colorStops[t].toString())),s}},Heart:bt};Nt.c,Nt.a,Nt.b;class It{constructor(){this.nodes=[]}isWon(){return!this.nodes.find(t=>t.value<0)}get(t){return this.nodes[t]}add(t){return this.nodes.push(t),this}magnetic(){const t=3*this.nodes[0].radius;this.nodes.forEach(e=>{if(!e.isDragged){const s=this.nodes.reduce((s,i)=>{const n=e.position.distance(i.position);return i!==e&&n<t&&s.add(e.position.clone().subtract(i.position).multiply((t-n)**2)),s},new y(0,0));e.position.add(s.divide(3e5))}})}toJSON(){const t=this.nodes.map(t=>t.toJSON());return t.forEach((t,e)=>{t.links=t.links.map(t=>this.nodes.indexOf(t.getOther(this.get(e))))}),t}static getNoduleRadius(t,e){return Math.min(...e)/(t**.5*2)}}function Lt(t){return new y(i.random(-t[0],t[0]),i.random(-t[1],t[1]))}const Jt=new C(void 0,{fill:"#f5f5f5"}),jt=.1*Math.min(Jt.width,Jt.height),Dt=[Jt.width/2-jt,Jt.height/2-jt],Gt=Math.floor(Jt.width*Jt.height/12e4),qt=(()=>{const t=Z.getItem("socsim");if(!t)return{};const e=Q(Q(t).slice(7));return JSON.parse(e)})();let $t,_t=qt.mv||0,Ft=qt.cl||0,Ut=qt.df||0;const Wt=new k(Jt.center);function Bt(t){Wt.empty(),$t=t?function(t,e){const s=It.getNoduleRadius(t.length,e),i=new It;for(let e=0,n=t.length;e<n;++e){const n=t[e],r=new X(n.position,s,n.value);n.links.filter(t=>t<e).map(t=>r.linkTo(i.nodes[t])),i.add(r)}return i}(t,Dt):function(t,e,s){const n=It.getNoduleRadius(e,t),r=new It;let o=0;for(let s=0;s<e;++s){let e;const s=()=>r.nodes.find(t=>t.position.distance(e)<2*n);do{e=Lt(t)}while(s());const a=new X(e,n);r.nodes.map((t,e)=>e).filter(t=>r.get(t).links.length<3).sort((t,s)=>r.get(t).position.distance(e)-r.get(s).position.distance(e)).slice(0,Math.round(i.random(1)+1)).forEach(t=>a.linkTo(r.get(t))),o+=a.links.length,r.add(a)}const a=Math.ceil(e**.5);let h=0;r.nodes.slice(1).forEach(t=>{const e=Math.round(i.random(2*a)-a);t.value=e,h+=e});const l=o-e+1,c=e/2*s;return r.get(0).value=l-h+c,r}(Dt,Math.floor(Gt+Ut),1-Ut%1);for(let t=0,e=$t.nodes.length;t<e;++t){const e=$t.get(t);Wt.add(...e.links,e)}}Jt.add(Wt);const Yt=[[V([-100,0],[1],1),V([100,0],[0],-1)],[V([-300,0],[1],2),V([0,0],[0,2],-4),V([300,0],[1],2)],(()=>{let t=0;const e=P.getRotatingPoints(3,200);return[V(e[t++],[1,2],3),V(e[t++],[0,2],-2),V(e[2],[0,1],1)]})(),(()=>{const t=P.getRotatingPoints(5,200);return[V([0,0],[],30),...t.map(t=>V(t,[0],-5))]})(),(()=>{let t=0;const e=P.getRotatingPoints(8,200);return[V(e[t++],[],5),V(e[t++],[t-2],1),V(e[t++],[t-2],1),V(e[t++],[t-2],1),V(e[t++],[t-2],-2),V(e[t++],[t-2],1),V(e[t++],[t-2],1),V(e[t++],[t-2,0],1)]})()];Bt(qt.gr||Yt[Ft]);const Xt=new N([0,0],Jt.width,Jt.height,{fill:"#111",opacity:.5,zIndex:10}),Vt=new G(Jt.center.subtract(0,70),"",{fill:"red",fontSize:70,align:"center",opacity:1,rotationAnchor:[0,35]});Xt.add(Vt);const Zt=new G([10,10],`Level: ${Ft}`,{fill:"#666"});function Kt(t){tt({cl:Ft,df:Ut,gr:!t&&$t,mv:!t&&_t})}Jt.add(Zt),Xt.on("click",()=>{Xt.delete(),_t=0,Bt(Yt[Ft]),Zt.text=`Level: ${Ft}`,Kt()}),Jt.on("lends",()=>{_t++,$t.isWon()?(Jt.add(Xt),Vt.text=`You won in ${_t} moves !`,Yt[Ft]||(Ut+=.6),Ft++,Kt(!0)):Kt()}).on("draw",()=>{Xt.options.shown&&(Vt.options.rotation=Math.cos(Vt.frameCount/20)/50),$t.magnetic()},!0).startLoop()}]);